---
title: Análise exploratória para dados de nascidos vivos diagnosticados com anomalia congênita - 11-20
header-includes:
  - \renewcommand{\contentsname}{Sumário}
output: 
  pdf_document:
    toc: yes
    toc_depth: "1"
    keep_tex: yes
  word_document: default
  html_document:
    self_contained: no
---

```{r setup, include = FALSE, echo = TRUE, message = FALSE, warning = FALSE, error = FALSE, results = 'hide', out.width = "70%"}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, error = FALSE)
```

```{r echo = FALSE, message = FALSE, warning = FALSE, error = FALSE, results = 'hide'}
#dados
library(dplyr)
library(tidyr)
library(purrr)
library(janitor)
library(stringr)
library(modelsummary)
library(questionr)
#graficos
library(ggplot2)
library(scales)
library(wesanderson)
#mapas
library(geobr)
library(ggspatial)
library(ggpubr)
#tabelas
library(knitr)
```

Neste relatório, será apresentada uma análise exploratória dos microdrados de anomalias congênitas obtidos das bases do Sistema de Informações sobre Nascidos Vivos (SINASC), previamente tratadas pela PCDaS com base no fluxo ETL (Extract, Transform e Load). Para a extração dos microdados, foram considerados todos os casos datados de 2011 a 2020 em que `IDANOMAL = 1 (Sim)` ou existia alguma resposta válida para `CODANOMAL`.

As bases são providas do portal openDataSUS, mantido pelo Ministério da Saúde.

\newpage

# 1. Dicionário das variáveis

Nesta seção, encontra-se o dicionário das variáveis que compõem as bases de dados do Sistema de Informações sobre Nascidos Vivos (SINASC) tratadas pela PCDaS.

Para as análises subsequentes, foram selecionados somente os casos em que o recém-nascido (RN) foi registrado com pelo menos uma CID-10 que faz parte do Capítulo XVII. Malformações congênitas, deformidades e anomalias cromossômicas (Q000-Q999) **ou** com a CID-10 D180, cuja descrição é hemangioma de qualquer localização.

```{r}
d_anom <- readr::read_csv("01.dados/anomalias/microdados_ac_11-20.csv.gz") |> 
  # selecionando anos de 2011 a 2020 e apenas cids do capitulo xvii + d180
  filter(
    as.numeric(ano_nasc) > 2010,
    str_detect(CODANOMAL, "Q") | str_detect(CODANOMAL, "D180")
 )
```

Sob as condições mencionadas, isto é, quando `IDANOMAL = 1 (Sim)` ou existia alguma resposta válida para `CODANOMAL` e o RN foi registrado com ao menos uma CID-10 contida no Capítulo XVII ou com a CID-10 D180, foram coletadas `r dim(d_anom)[1]` observações para as quais haviam ou não informações em **135 variáveis**. São elas:

## Variáveis SINASC

-   **...1**: Índice
-   **APGAR1**: Apgar no primeiro minuto 00 a 10
-   **APGAR5**: Apgar no quinto minuto 00 a 10
-   **CODANOMAL**: Código de malformação congênita ou anomalia cromossômica, de acordo com a CID-10
-   **CODBAINASC**: Código do bairro de nascimento
-   **CODBAIRES**: Código do bairro de residência
-   **CODCART**: Código de Cartório
-   **CODESTAB**: Código do estabelecimento onde ocorreu o nascimento
-   **CODINST**: Código da Instalação da geração dos Registros
-   **CODMUNCART**: Código do município do cartório
-   **CODMUNNASC**: Município de ocorrência, em codificação idêntica a de CODMUNRES, conforme tabela TABMUN
-   **CODMUNNATU**: Código do município de naturalidade da mãe
-   **CODMUNRES**: Município de residência da mãe, em codificação idêntica a de CODMUNNASC, conforme tabela TABMUN
-   **CODOCUPMAE**: Ocupação, conforme a Classificação Brasileira de Ocupações (CBO-2002)
-   **CODPAISRES**: Código do país de residência
-   **CODUFNATU**: Código da UF de naturalidade da mãe
-   **CODPAISRES**: Código do país de residência
-   **CODUFNATU**: Código da UF de naturalidade da mãe
-   **CONSPRENAT**: Número de consultas pré‐natal
-   **CONSULTAS**: Número de consultas de pré-natal: 1: Nenhuma; 2: de 1 a 3; 3: de 4 a 6; 4: 7 e mais; 9: Ignorado
-   **CONTADOR**: Número identificador do registro
-   **CODPAISRES**: Código do país de residência
-   **CODUFNATU**: Código da UF de naturalidade da mãe
-   **CONSPRENAT**: Número de consultas pré‐natal
-   **CONSULTAS**: Número de consultas de pré-natal: 1: Nenhuma; 2: de 1 a 3; 3: de 4 a 6; 4: 7 e mais; 9: Ignorado
-   **CONTADOR**: Número identificador do registro
-   **DIFDATA**: Diferença entre a data de Nascimento e data do recebimento original da DN ([DTNASC] - [DTRECORIGA])
-   **DTCADASTRO**: Data do cadastro da DN no sistema
-   **DTDECLARAC**: Data da declaração: dd mm aaaa
-   **DTNASC**: Data do nascimento, no formato ddmmaaaa
-   **DTNASCMAE**: Data de nascimento da mãe
-   **DTRECEBIM**: Data de recebimento no nível central, data da última atualização do registro
-   **DTRECORIG**: Data do primeiro recebimento do lote, dada pelo Sisnet
-   **DTRECORIGA**: Cria-se campo DTRECORIGA e copia os valores de DTRECORIG para esse campo. Se DTRECORIGA = Nulo, copia os valores de DTRECEBIM. Se DTRECEBIM = Nulo, copia os valores de DTCADASTRO
-   **DTREGCART**: Data do registro do cartório
-   **DTULTMENST**: Data da última menstruação (DUM): dd mm aaaa
-   **ESCMAE**: Escolaridade, anos de estudo concluídos: 1: Nenhuma; 2: 1 a 3 anos; 3: 4 a 7 anos; 4: 8 a 11 anos; 5: 12 e mais; 9: Ignorado
-   **ESCMAE2010**: Escolaridade 2010. Valores: 0 - Sem escolaridade; 1 - Fundamental I (1a a 4a série); 2 - Fundamental II (5a a 8a série); 3 - Médio (antigo 2o Grau); 4 - Superior incompleto; 5 - Superior completo; 9 - Ignorado
-   **ESCMAEAGR1**: Escolaridade 2010 agregada. Valores: 00 - Sem Escolaridade; 01 - Fundamental I Incompleto; 02 - Fundamental I Completo; 03 - Fundamental II Incompleto; 04 - Fundamental II Completo; 05 - Ensino Médio Incompleto; 06 - Ensino Médio Completo; 07 - Superior Incompleto; 08 - Superior Completo; 09 - Ignorado; 10 -- Fundamental I Incompleto ou Inespecífico; 11 - Fundamental II Incompleto ou Inespecífico; 12 - Ensino Médio Incompleto ou Inespecífico
-   **ESTCIVMAE**: Estado civil, conforme a tabela: 1: Solteira; 2: Casada; 3: Viuva; 4: Separado judicialmente/Divorciado; 5: União consensual (versões anteriores); 9: Ignorado
-   **GESTACAO**: Semanas de gestação, conforme a tabela: 9: Ignorado; 1: Menos de 22 semanas; 2: 22 a 27 semanas; 3: 28 a 31 semanas; 4: 32 a 36 semanas; 5: 37 a 41 semanas; 6: 42 semanas e mais
-   **GRAVIDEZ**: Tipo de gravidez, conforme a tabela: 9: Ignorado; 1: Única; 2: Dupla; 3: Tripla e mais
-   **HORANASC**: Horário de nascimento
-   **IDADEMAE**: Idade da mãe em anos
-   **IDADEPAI**: Idade do pai
-   **IDANOMAL**: Anomalia congênita: 9: Ignorado; 1: Sim; 2: Não
-   **KOTELCHUCK**: Índice de Kotelchuck - Avaliação de assistência pré-natal
-   **LOCNASC**: Local de ocorrência do nascimento, conforme a tabela: 9: Ignorado; 1: Hospital; 2: Outro Estab Saúde; 3: Domicílio; 4: Outros
-   **MESPRENAT**: Mês de gestação em que iniciou o pré‐natal
-   **NATURALMAE**: Se a mãe for estrangeira, constará o código do país de nascimento
-   **NOVO**: -
-   **NUMERODN**: Número da DN, sequencial por UF informante e por ano
-   **NUMEROLOTE**: Número do lote
-   **NUMREGCART**: Número do Registro do Cartório
-   **ORIGEM**: Banco de dados de Origem 1 Oracle, 2 FTP, 3 - SEAD
-   **PARIDADE**: Define se é a primeira gravidez ou se teve mais de uma. 1 - Multípara; 0 - Nulípara
-   **PARTO**: Tipo de parto, conforme a tabela: 9: Ignorado; 1: Vaginal; 2: Cesáreo
-   **PESO**: Peso ao nascer, em gramas
-   **PREFIXODN**: Prefixo da DN
-   **QTDFILMORT**: Número de filhos mortos
-   **QTDFILVIVO**: Número de filhos vivos
-   **QTDGESTANT**: Número de gestações anteriores
-   **QTDPARTCES**: Número de partos cesáreos
-   **QTDPARTNOR**: Número de partos vaginais
-   **RACACOR**: Raça/Cor da mãe: 1: Branca; 2: Preta; 3: Amarela; 4: Parda; 5: Indígena
-   **RACACOR_RN**: Tipo de raça e cor do nascido: 1 - Branca; 2 - Preta; 3 - Amarela; 4 - Parda; 5 - Indígena
-   **SEMAGESTAC**: Número de semanas de gestação
-   **SERIESCMAE**: Série escolar da mãe. Valores de 1 a 8
-   **SEXO**: Sexo, conforme a tabela: 0: Ignorado, não informado; 1: Masculino; 2: Feminino
-   **STCESPARTO**: Cesárea ocorreu antes do trabalho de parto iniciar? Valores: 1 - Sim; 2 - Não; 3 - Não se aplica; 9 - Ignorado
-   **STDNEPIDEM**: Status de DO Epidemiológica. Valores: 1 - SIM; 0 - NÃO
-   **STDNNOVA**: Status de DO Nova. Valores: 1 - SIM; 0 - NÃO
-   **STTRABPART**: Trabalho de parto induzido? Valores: 1 - Sim; 2 - Não; 3 - Não se aplica; 9 - Ignorado
-   **TPAPRESENT**: Tipo de apresentação do RN. Valores: 1 - Cefálico; 2 - Pélvica ou podálica; 3 - Transversa; 9 - Ignorado
-   **TPDOCRESP**: Tipo do documento do responsável. Valores: 1 - CNES; 2 - CRM; 3 - COREN; 4 - RG; 5 - CPF
-   **TPFUNCRESP**: Tipo de função do responsável pelo preenchimento. Valores:1 - Médico; 2 - Enfermeiro; 3 - Parteira; 4 - Funcionário docartório; 5 - Outros
-   **TPMETESTIM**: Método utilizado. Valores: 1 - Exame físico; 2 - Outro método; 9 - Ignorado
-   **TPNASCASSI**: Nascimento foi assistido por? Valores: 1 - Médico; 2 - Enfermeira/obstetriz; 3 - Parteira; 4 - Outros; 9 - Ignorado
-   **TPROBSON**: Código do Grupo de Robson, gerado pelo sistema
-   **UFINFORM**: Código da UF que informou o registro
-   **VERSAOSIST**: Versão do sistema

## Variáveis PCDaS

-   **ano_nasc**: Ano do nascimento
-   **codanomal_capitulo**: Capítulo CID-10 da malformação congênita ou anomalia cromossômica
-   **codanomal_categoria**: Categoria CID-10 da malformação congênita ou anomalia cromossômica
-   **codanomal_grupo**: Grupo CID-10 da malformação congênita ou anomalia cromossômica
-   **codanomal_subcategoria**: Subcategoria CID-10 da malformação congênita ou anomalia cromossômica
-   **contador**: -
-   **data_nasc**: Data de nascimento
-   **def_anomalia**: Anomalia congênita (Ignorado; Sim; Não)
-   **def_consultas**: Número de consultas durante o pré-natal (Nenhuma; de 1 a 3; de 4 a 6; 7 e mais; Ignorado)
-   **def_escol_mae**: Escolaridade da mãe (Nenhuma; de 1 a 3 anos; de 4 a 7 anos; 8 a 11 anos; 12 anos e mais; Ignorado)
-   **def_est_civil**: Estado civil (Situação conjugal: Solteiro; Casado; Viúvo; Separado judicialmente/divorciado; União estável; Ignorado)
-   **def_gestacao**: Semana de gestação (Nominal, com as seguintes classificações: Menos de 22 semanas; 22 a 27 semanas; 28 a 31 semanas; 32 a 36 semanas; 37 a 41 semanas; 42 semanas ou mais)
-   **def_gravidez**: Tipo de gravidez (Nominal, com as seguintes classificações: Única; Dupla; Tripla e mais e Ignorada)
-   **def_loc_nasc**: Local de nascimento (Nominal, com as seguintes classificações: Hospital; Outros estabelecimentos de saúde; Domicílio; Via pública; Outros; Ignorado)
-   **def_parto**: Tipo de parto (Nominal, com as seguintes classificações: Vaginal; Cesáreo; Ignorado)
-   **def_parto_prematuro**: Indica a prematuridade do nascimento. Termo: não há indícios de prematuridade; Inconclusivo-IG: há indício de prematuridade dado pela idade gestacional (`GESTACAO<=4`); Inconclusivo-Peso: há indício de prematuridade dado pelo peso ao nascer (`PESO<2500`); Prematuro: a idade gestacional e o peso ao nascer indicam prematuridade
-   **def_raca_cor**: Raça/cor do nascido (Nominal, com as seguintes classificações: Branca; Preta; Amarela; Parda; Indígena)
-   **def_sexo**: Sexo (Nominal, com as seguintes classificações: Masculino; Feminino; Ignorado)
-   **dia_semana_nasc**: Dia da semana em que ocorreu o nascimento (dom; seg; ter; qua; qui; sex; sáb)
-   **nasc_ALTITUDE**: Altitude do município de nascimento
-   **nasc_AMAZONIA**: Indica (S/N) se o município de nascimento faz parte da Amazônia Legal (conforme IBGE)
-   **nasc_AREA**: Área do município de nascimento
-   **nasc_CAPITAL**: Indica (S/N) se o município de nascimento é capital de UF
-   **nasc_CODIGO_UF**: Código da UF de nascimento
-   **nasc_CSAUDCOD**: Código da Microrregional de Saúde a que o Município de nascimento pertence
-   **nasc_FRONTEIRA**: Indica (S/N) se o município de nascimento faz parte da faixa de fronteira (conforme IBGE)
-   **nasc_LATITUDE**: Latitude do município de nascimento
-   **nasc_LONGITUDE**: Longitude do município de nascimento
-   **nasc_MSAUDCOD**: Código da Macrorregional de Saúde a que o Município de nascimento pertence
-   **nasc_MUNNOME**: Nome do município de nascimento
-   **nasc_MUNNOMEX**: Nome do município de nascimento em maiúsculas e sem acentos
-   **nasc_NOME_UF**: Nome da unidade da federação de nascimento
-   **nasc_REGIAO**: Nome da região da unidade da federação de nascimento
-   **nasc_RSAUDCOD**: Código da Regional de Saúde a que o Município de nascimento pertence
-   **nasc_SIGLA_UF**: Sigla da unidade da federação de nascimento
-   **nasc_codigo_adotado**: Armazena o código atribuído ao município de nascimento atualmente, tratando os casos em que múltiplos códigos tenham sido utilizados para um mesmo município ao longo do tempo
-   **nasc_coordenadas**: Coordenadas do município de nascimento
-   **parto_prematuro**: Indica a prematuridade do nascimento. 0: não há indícios de prematuridade; 1: há indício de prematuridade dado pela idade gestacional (`GESTACAO<=4`); 2: há indício de prematuridade dado pelo peso ao nascer (`PESO<2500`); 3: a idade gestacional e o peso ao nascer indicam prematuridade
-   **res_ALTITUDE**: Altitude do município de residência
-   **res_AMAZONIA**: Indica (S/N) se o município de residência faz parte da Amazônia Legal (conforme IBGE)
-   **res_ANOEXT**: -
-   **res_AREA**: Área do município de residência
-   **res_CAPITAL**: Indica (S/N) se o município de residência é capital de UF
-   **res_CODIGO_UF**: Código da UF de residência
-   **res_CSAUDCOD**: Código da Microrregional de Saúde a que o Município de residência pertence
-   **res_FRONTEIRA**: Indica (S/N) se o município de residência faz parte da faixa de fronteira (conforme IBGE)
-   **res_LATITUDE**: Latitude do município de residência
-   **res_LONGITUDE**: Longitude do município de residência
-   **res_MSAUDCOD**: Código da Macrorregional de Saúde a que o Município de residência pertence
-   **res_MUNNOME**: Nome do município de residência
-   **res_MUNNOMEX**: Nome do município de residência em maiúsculas e sem acentos
-   **res_NOME_UF**: Nome da unidade da federação de residência
-   **res_REGIAO**: Nome da região da unidade da federação de residência
-   **res_RSAUDCOD**: Código da Regional de Saúde a que o Município de residência pertence
-   **res_SIGLA_UF**: Sigla da unidade da federação de residência
-   **res_SUCESSOR**: -
-   **res_codigo_adotado**: Armazena o código atribuído ao município de residência atualmente, tratando os casos em que múltiplos códigos tenham sido utilizados para um mesmo município ao longo do tempo
-   **res_coordenadas**: Coordenadas do município de residência

\newpage

# 2. Manipulação dos dados

Nesta seção, foi feita uma breve higienização dos dados a fim de melhor manipulá-los.

### Transformando valores 99 e categoria 'ignorado' em NAs

```{r}
d_anom <- d_anom |>  
  mutate(
    CONSPRENAT = as.numeric(ifelse(CONSPRENAT == 99, NA_character_, CONSPRENAT)),
    IDADEMAE = as.numeric(ifelse(IDADEMAE == 99, NA_character_, IDADEMAE)),
    IDADEPAI = as.numeric(ifelse(IDADEPAI == 99, NA_character_, IDADEPAI)),
    KOTELCHUCK = as.numeric(ifelse(KOTELCHUCK == 9, NA_character_, KOTELCHUCK)),
    MESPRENAT = as.numeric(ifelse(MESPRENAT == 99, NA_character_, MESPRENAT)),
    PESO = as.numeric(ifelse(PESO == 9999, NA_character_, PESO)),
    QTDFILMORT = as.numeric(ifelse(QTDFILMORT == 99, NA_character_, QTDFILMORT)),
    QTDFILVIVO = as.numeric(ifelse(QTDFILVIVO == 99, NA_character_, QTDFILVIVO)),
    QTDGESTANT = as.numeric(ifelse(QTDGESTANT == 99, NA_character_, QTDGESTANT)),
    QTDPARTCES = as.numeric(ifelse(QTDPARTCES == 99, NA_character_, QTDPARTCES)),
    QTDPARTNOR = as.numeric(ifelse(QTDPARTNOR == 99, NA_character_, QTDPARTNOR)),
    def_anomalia = ifelse(def_anomalia == "Ignorado", NA_character_, def_anomalia),
    def_consultas = ifelse(def_consultas == "Ignorado", NA_character_, def_consultas),
    def_escol_mae = ifelse(def_escol_mae == "Ignorado", NA_character_, def_escol_mae),
    def_est_civil = ifelse(def_est_civil == "Ignorado", NA_character_, def_est_civil),
    def_gestacao = ifelse(def_gestacao == "Ignorado", NA_character_, def_gestacao),
    def_gravidez = ifelse(def_gravidez == "Ignorado", NA_character_, def_gravidez),
    def_loc_nasc = ifelse(def_loc_nasc == "Ignorado", NA_character_, def_loc_nasc),
    def_parto = ifelse(def_parto == "Ignorado", NA_character_, def_parto),
    def_parto_prematuro = ifelse(def_parto_prematuro == "Ignorado", NA_character_,
                                   def_parto_prematuro),
    def_raca_cor = ifelse(def_raca_cor == "Ignorado", NA_character_, def_raca_cor),
    def_sexo = ifelse(def_sexo == "Ignorado", NA_character_, def_sexo),
    TPROBSON = ifelse((d_anom$TPROBSON == 11 | d_anom$TPROBSON == 12),
                         NA_character_, d_anom$TPROBSON)
 )
```

### Separando casos em que o nascido tem mais de uma malformação congênita

```{r}
d_anom <- d_anom %>%
  separate(
    ., col = CODANOMAL, 
    into = c("coda1", "coda2", "coda3", "coda4", "coda5", "coda6"), sep = "Q", 
    remove = FALSE
  ) |>
  # incluindo na nas celulas vazias das cids
  mutate(
    coda1 = ifelse(coda1 == "", NA_character_, coda1),
    coda2 = ifelse(coda2 == "", NA_character_, coda2),
    coda3 = ifelse(coda3 == "", NA_character_, coda3),
    coda4 = ifelse(coda4 == "", NA_character_, coda4),
    coda5 = ifelse(coda5 == "", NA_character_, coda5),
    coda6 = ifelse(coda6 == "", NA_character_, coda6)
  ) |> 
  # retirando espaco entre os caracteres das cids
  mutate(
    coda1 = gsub(" ", "", coda1),
    coda2 = gsub(" ", "", coda2),
    coda3 = gsub(" ", "", coda3),
    coda4 = gsub(" ", "", coda4),
    coda5 = gsub(" ", "", coda5),
    coda6 = gsub(" ", "", coda6)
  )
```

### Incluindo 'Q' nas CID-10 relacionadas ao Capítulo XVII e separando e incluindo NA\* nas CID-10\*\* que não fazem parte do Capítulo XVII

*\* Exceto a CID-10 D180.*

*\*\* Algumas doenças que fazem parte dos capítulos I, II, III, IV, XI e XII.*

```{r}
d_anom <- d_anom |> 
  mutate(
    coda1 = ifelse(str_length(coda1) == 3, paste0("Q", coda1), coda1),
    coda2 = ifelse(str_length(coda2) == 3, paste0("Q", coda2), coda2),
    coda3 = ifelse(str_length(coda3) == 3, paste0("Q", coda3), coda3),
    coda4 = ifelse(str_length(coda4) == 3, paste0("Q", coda4), coda4),
    coda5 = ifelse(str_length(coda5) == 3, paste0("Q", coda5), coda5),
    coda6 = ifelse(str_length(coda6) == 3, paste0("Q", coda6), coda6),
    # casos que nao fazem parte do capitulo xvii
    coda7 = str_sub(coda1, end = 4),
    coda8 = str_sub(coda1, start = 5, end = 8),
    coda9 = str_sub(coda1, start = 9, end = 12)
  ) |>
  # incluindo na em cids que nao fazem parte do capitulo xvii
  mutate(
    coda7 = ifelse((str_detect(coda7, "C") | str_detect(coda7, "E") |
                     str_detect(coda7, "K")| str_detect(coda7, "P") |
                      coda7 == "D649" | coda7 == "D823"), NA, coda7),
    coda8 = ifelse((coda8 == "D691" | coda8 == "P285" | coda8 == "P294" |
                     coda8 == "P299"), NA, coda8),
    coda9 = ifelse(coda9 == "K429", NA, coda9)
  ) |>
  # incluindo na nas celulas vazias
  mutate(
    coda7 = ifelse(coda7 == "", NA_character_, coda7),
    coda8 = ifelse(coda8 == "", NA_character_, coda8),
    coda9 = ifelse(coda9 == "", NA_character_, coda9)
 )
```

\newpage

# 3. Anomalias congênitas e cromossômicas

Nesta seção, o objetivo consistiu em identificar os RNs classificados com malformação congênita ou cromossômica. Os casos em que havia pelo menos uma malformação cromossômica, cuja CID-10 está entre Q900-Q999, foram **removidos** das análises subsequentes.

### Criando variável indicadora para identificar os RNs classificados com malformação congênita ou malformação cromossômica

```{r}
d_anom <- d_anom |>
  mutate(
    class_malf = case_when(
    str_detect(CODANOMAL, "Q9") ~ "cromossômica",
    TRUE ~ "congênita"
   )
 )
```

```{r}
freq(
  d_anom$class_malf,
  cum = FALSE, total = TRUE,
  na.last = FALSE, valid = TRUE
  ) |>
  kable(
    caption = "Tabela de frequências para o número de RNs com malformações congênitas e malformações cromossômicas.", 
    digits = 4
  ) |> 
  kableExtra::kable_styling(latex_options = "HOLD_position")
```

\newpage

# 4. Anomalias congênitas menores e maiores

Nesta seção, as anomalias congênitas foram classificadas em malformação congênita maior ou malformação congênita menor, conforme definição da *European Surveillance of Congenital Anomalies* (EUROCAT). O objetivo dessa análise é identificar a quantidade verdadeira de anomalias pela qual o nascido foi acometido.

Para o cálculo das malformações e análises subsequentes, foram removidas **apenas** as anomalias congênitas menores únicas e menores múltiplas (ou seja, quando o nascido tem mais de uma malformação, porém todas consideradas como menor). Portanto, se um RN foi registrado com as CID-10 Q539 (menor) e Q793 (maior), por exemplo, ambas foram consideradas na contagem e a malformação classificada como múltipla.

### Criando variável indicadora que identifica a classificação, se maior ou menor, da malformação congênita

```{r}
# cids maiores, segundo eurocat

cid_maior <- readxl::read_xlsx("tab_auxiliares/cid10_eurocat.xlsx", sheet = 1)

# cids menores, segundo eurocat

cid_menor <- readxl::read_xlsx("tab_auxiliares/cid10_eurocat.xlsx", sheet = 2)

# classificando malformacao em maior ou menor

d_anom <- d_anom |> 
  # removendo malformacoes cromossomicas
  filter(class_malf == "congênita") |> 
  mutate(
    malf1 = NA_character_,
    malf2 = case_when(
      coda2 %in% cid_maior$categoria_cid10 ~ "maior",
      coda2 == "Q250" & (def_gestacao == "37 a 41 semanas" | 
                           def_gestacao == "42 semanas e mais") ~ "maior",
      coda2 == "Q250" & (!(def_gestacao == "37 a 41 semanas" | 
                             def_gestacao == "42 semanas e mais")) ~ "menor",
      coda2 %in% cid_menor$categoria_cid10 ~ "menor",
      TRUE ~ NA_character_
    ),
    malf3 = case_when(
      coda3 %in% cid_maior$categoria_cid10 ~ "maior",
      coda3 == "Q250" & (def_gestacao == "37 a 41 semanas" | 
                           def_gestacao == "42 semanas e mais") ~ "maior",
      coda3 == "Q250" & (!(def_gestacao == "37 a 41 semanas" | 
                             def_gestacao == "42 semanas e mais")) ~ "menor",
      coda3 %in% cid_menor$categoria_cid10 ~ "menor",
      TRUE ~ NA_character_
    ),
    malf4 = case_when(
      coda4 %in% cid_maior$categoria_cid10 ~ "maior",
      coda4 == "Q250" & (def_gestacao == "37 a 41 semanas" | 
                           def_gestacao == "42 semanas e mais") ~ "maior",
      coda4 == "Q250" & (!(def_gestacao == "37 a 41 semanas" | 
                             def_gestacao == "42 semanas e mais")) ~ "menor",
      coda4 %in% cid_menor$categoria_cid10 ~ "menor",
      TRUE ~ NA_character_
    ),
    malf5 = case_when(
      coda5 %in% cid_maior$categoria_cid10 ~ "maior",
      coda5 == "Q250" & (def_gestacao == "37 a 41 semanas" | 
                          def_gestacao == "42 semanas e mais") ~ "maior",
      coda5 == "Q250" & (!(def_gestacao == "37 a 41 semanas" | 
                            def_gestacao == "42 semanas e mais")) ~ "menor",
      coda5 %in% cid_menor$categoria_cid10 ~ "menor",
      TRUE ~ NA_character_
    ),
    malf6 = case_when(
      coda6 %in% cid_maior$categoria_cid10 ~ "maior",
      coda6 == "Q250" & (def_gestacao == "37 a 41 semanas" | 
                           def_gestacao == "42 semanas e mais") ~ "maior",
      coda6 == "Q250" & (!(def_gestacao == "37 a 41 semanas" | 
                             def_gestacao == "42 semanas e mais")) ~ "menor",
      coda6 %in% cid_menor$categoria_cid10 ~ "menor",
      TRUE ~ NA_character_
    ),
    malf7 = case_when(
      coda7 %in% cid_maior$categoria_cid10 ~ "maior",
      coda7 == "Q250" & (def_gestacao == "37 a 41 semanas" | 
                           def_gestacao == "42 semanas e mais") ~ "maior",
      coda7 == "Q250" & (!(def_gestacao == "37 a 41 semanas" | 
                             def_gestacao == "42 semanas e mais")) ~ "menor",
      coda7 %in% cid_menor$categoria_cid10 ~ "menor",
      TRUE ~ NA_character_
    )
  )
```

### Criando variável indicadora para identificar os RNs classificados com malformação maior única, malformação maior múltipla ou só com malformação menor\*

*\* Única ou múltipla.*

O número total de RNs registrados somente com malformações menores é de 47.493 e o número total de malformações menores desses RNs é de 68.510.

```{r}
### malformacoes menores ###

dados_malf_men <- d_anom |> 
  select(malf2, malf3, malf4, malf5, malf6, malf7) |> 
  # transformando 'menor' em 1 e 'maior' em zero
  mutate(
    malf2 = as.numeric(ifelse(malf2 == "menor", 1, 0)),
    malf3 = as.numeric(ifelse(malf3 == "menor", 1, 0)),
    malf4 = as.numeric(ifelse(malf4 == "menor", 1, 0)),
    malf5 = as.numeric(ifelse(malf5 == "menor", 1, 0)),
    malf6 = as.numeric(ifelse(malf6 == "menor", 1, 0)),
    malf7 = as.numeric(ifelse(malf7 == "menor", 1, 0))
  )

# somando as malformacoes menores

n_malf_men <- rowSums(dados_malf_men, na.rm = TRUE)

# incluindo numero de malformacoes menores por nascido

d_anom <- d_anom |> 
  mutate(n_malf_men = n_malf_men)

### malformacoes maiores ###

dados_malf_maior <- d_anom |> 
  select(malf2, malf3, malf4, malf5, malf6, malf7) |> 
  # transformando 'maior' em 1 e 'menor' em zero
  mutate(
    malf2 = as.numeric(ifelse(malf2 == "maior", 1, 0)),
    malf3 = as.numeric(ifelse(malf3 == "maior", 1, 0)),
    malf4 = as.numeric(ifelse(malf4 == "maior", 1, 0)),
    malf5 = as.numeric(ifelse(malf5 == "maior", 1, 0)),
    malf6 = as.numeric(ifelse(malf6 == "maior", 1, 0)),
    malf7 = as.numeric(ifelse(malf7 == "maior", 1, 0))
  )

# somando as malformacoes maiores

n_malf_maior <- rowSums(dados_malf_maior, na.rm = TRUE)

# incluindo numero de malformacoes maiores por nascido

d_anom <- d_anom |> 
  mutate(n_malf_maior = n_malf_maior)

### malformacao maior unica, maior multipla ou so menor ###

d_anom <- d_anom |> 
  mutate(
    ind_malf_maior = case_when(
    n_malf_men >= 1 & n_malf_maior == 0 ~ "só menor",
    n_malf_men == 0 & n_malf_maior == 1 ~ "única",
    n_malf_men >= 1 & n_malf_maior >= 1 ~ "múltipla",
    n_malf_men == 0 & n_malf_maior > 1 ~ "múltipla",
    TRUE ~ NA_character_
   )
 )
```

### Calculando o número de malformações, segundo a EUROCAT

Código omitido. Verificar no arquivo `anom.Rmd`.

```{r echo=FALSE}
# # tabela que identifica o grupo e subgrupo das cids
# 
# dados_subgrupos <- readxl::read_xlsx("tab_auxiliares/subgrupos_cid10.xlsx") |>
#   mutate(grupo_uni = paste(grupo, subgrupo))
# 
# # contagem de malformacoes
# 
# d <- d_anom |>
#   # removendo malformacoes menores
#   filter(ind_malf_maior != "só menor") |>
#   select(coda2:coda6, coda7, malf2:malf7) |>
#   mutate(
#     id = 1:179182,
#     result2 = ifelse(is.na(coda2), 0, 1), #coda2
#     result3 = 0,
#     result4 = 0,
#     result5 = 0,
#     result6 = 0,
#     result7 = 0
#   ) |>
#   mutate(
#     cid2 = ifelse(is.na(coda2), NA, coda2),
#     cid3 = NA,
#     cid4 = NA,
#     cid5 = NA,
#     cid6 = NA,
#     cid7 = NA
#   ) |>
#   group_split(id)
# 
# soma_cids <- lapply(d, function(ind){
#   cid2 <- ind$coda2
#   # coda3
#   if(is.na(ind$malf3)){
#     res3 <- 0
#     cid3 <- NA
#   } else if(ind$malf3 == "menor"){
#     res3 <- 1
#     cid3 <- ind$coda3
#   } else if(dados_subgrupos |>
#             filter(cid %in% c(ind$coda3)) |>
#             pull(cid) |>
#             length() == 0){
#     res3 <- 1
#     cid3 <- ind$coda3
#   } else{
#     filtro_coda2 <- dados_subgrupos |>
#       filter(cid == ind$coda2) |>
#       pull(grupo_uni)
# 
#     cids_coda2 <- dados_subgrupos |>
#       filter(grupo_uni %in% c(filtro_coda2)) |>
#       pull(cid)
# 
#     if(ind$coda3 %in% c(cids_coda2)){
#       res3 <- 0
#       cid3 <- NA
#       cid2 <- paste0(cid2, "-", ind$coda3)
#     } else {
#       res3 <- 1
#       cid3 <- ind$coda3
#     }
#   }
#   # coda4
#   if(is.na(ind$malf4)){
#     res4 <- 0
#     cid4 <- NA
#   } else if(ind$malf4 == "menor"){
#     res4 <- 1
#     cid4 <- ind$coda4
#   } else if(dados_subgrupos |>
#             filter(cid %in% c(ind$coda4)) |>
#             pull(cid) |>
#             length() == 0){
#     res4 <- 1
#     cid4 <- ind$coda4
#   } else{
#     filtro_coda2 <- dados_subgrupos |>
#       filter(cid == ind$coda2) |>
#       pull(grupo_uni)
# 
#     filtro_coda3 <- dados_subgrupos |>
#       filter(cid == ind$coda3) |>
#       pull(grupo_uni)
# 
#     cids_coda2 <- dados_subgrupos |>
#       filter(grupo_uni %in% c(filtro_coda2)) |>
#       pull(cid)
# 
#     cids_coda3 <- dados_subgrupos |>
#       filter(grupo_uni %in% c(filtro_coda3)) |>
#       pull(cid)
# 
#     if(ind$coda4 %in% c(cids_coda2, cids_coda3)){
#       res4 <- 0
#       cid4 <- NA
#       if(ind$coda4 %in% cids_coda2) cid2 <- paste0(cid2, "-", ind$coda4)
#       else if(ind$coda4 %in% cids_coda3) cid3 <- paste0(cid3, "-", ind$coda4)
#     } else{
#       res4 <- 1
#       cid4 <- ind$coda4
#     }
#   }
#   # coda5
#   if(is.na(ind$malf5)){
#     res5 <- 0
#     cid5 <- NA
#   } else if(ind$malf5 == "menor"){
#     res5 <- 1
#     cid5 <- ind$coda5
#   } else if(dados_subgrupos |>
#             filter(cid %in% c(ind$coda5)) |>
#             pull(cid) |>
#             length() == 0){
#     res5 <- 1
#     cid5 <- ind$coda5
#   } else{
#     filtro_coda2 <- dados_subgrupos |>
#       filter(cid == ind$coda2) |>
#       pull(grupo_uni)
# 
#     filtro_coda3 <- dados_subgrupos |>
#       filter(cid == ind$coda3) |>
#       pull(grupo_uni)
# 
#     filtro_coda4 <- dados_subgrupos |>
#       filter(cid == ind$coda4) |>
#       pull(grupo_uni)
# 
#     cids_coda2 <- dados_subgrupos |>
#       filter(grupo_uni %in% c(filtro_coda2)) |>
#       pull(cid)
# 
#     cids_coda3 <- dados_subgrupos |>
#       filter(grupo_uni %in% c(filtro_coda3)) |>
#       pull(cid)
# 
#     cids_coda4 <- dados_subgrupos |>
#       filter(grupo_uni %in% c(filtro_coda4)) |>
#       pull(cid)
# 
#     if(ind$coda5 %in% c(cids_coda2, cids_coda3, cids_coda4)){
#       res5 <- 0
#       cid5 <- NA
#       if(ind$coda5 %in% cids_coda2) cid2 <- paste0(cid2, "-", ind$coda5)
#       else if(ind$coda5 %in% cids_coda3) cid3 <- paste0(cid3, "-", ind$coda5)
#       else if(ind$coda5 %in% cids_coda4) cid4 <- paste0(cid4, "-", ind$coda5)
#     } else{
#       res5 <- 1
#       cid5 <- ind$coda5
#     }
#   }
#   # coda6
#   if(is.na(ind$malf6)){
#     res6 <- 0
#     cid6 <- NA
#   } else if(ind$malf6 == "menor"){
#     res6 <- 1
#     cid6 <- ind$coda6
#   } else if(dados_subgrupos |>
#             filter(cid %in% c(ind$coda6)) |>
#             pull(cid) |>
#             length() == 0){
#     res6 <- 1
#     cid6 <- ind$coda6
#   } else{
#     filtro_coda2 <- dados_subgrupos |>
#       filter(cid == ind$coda2) |>
#       pull(grupo_uni)
# 
#     filtro_coda3 <- dados_subgrupos |>
#       filter(cid == ind$coda3) |>
#       pull(grupo_uni)
# 
#     filtro_coda4 <- dados_subgrupos |>
#       filter(cid == ind$coda4) |>
#       pull(grupo_uni)
# 
#     filtro_coda5 <- dados_subgrupos |>
#       filter(cid == ind$coda5) |>
#       pull(grupo_uni)
# 
#     cids_coda2 <- dados_subgrupos |>
#       filter(grupo_uni %in% c(filtro_coda2)) |>
#       pull(cid)
# 
#     cids_coda3 <- dados_subgrupos |>
#       filter(grupo_uni %in% c(filtro_coda3)) |>
#       pull(cid)
# 
#     cids_coda4 <- dados_subgrupos |>
#       filter(grupo_uni %in% c(filtro_coda4)) |>
#       pull(cid)
# 
#     cids_coda5 <- dados_subgrupos |>
#       filter(grupo_uni %in% c(filtro_coda5)) |>
#       pull(cid)
# 
#     if(ind$coda6 %in% c(cids_coda2, cids_coda3, cids_coda4, cids_coda5)){
#       res6 <- 0
#       cid6 <- NA
#       if(ind$coda6 %in% cids_coda2) cid2 <- paste0(cid2, "-", ind$coda6)
#       else if(ind$coda6 %in% cids_coda3) cid3 <- paste0(cid3, "-", ind$coda6)
#       else if(ind$coda6 %in% cids_coda4) cid4 <- paste0(cid4, "-", ind$coda6)
#       else if(ind$coda6 %in% cids_coda5) cid5 <- paste0(cid5, "-", ind$coda6)
#     } else{
#       res6 <- 1
#       cid6 <- ind$coda6
#     }
#   }
#   # coda7
#   if(is.na(ind$malf7)){
#     res7 <- 0
#     cid7 <- NA
#   } else if(ind$malf7 == "menor"){
#     res7 <- 1
#     cid7 <- ind$coda7
#   } else if(dados_subgrupos |>
#             filter(cid %in% c(ind$coda7)) |>
#             pull(cid) |>
#             length() == 0){
#     res7 <- 1
#     cid7 <- ind$coda7
#   } else{
#     filtro_coda2 <- dados_subgrupos |>
#       filter(cid == ind$coda2) |>
#       pull(grupo_uni)
# 
#     filtro_coda3 <- dados_subgrupos |>
#       filter(cid == ind$coda3) |>
#       pull(grupo_uni)
# 
#     filtro_coda4 <- dados_subgrupos |>
#       filter(cid == ind$coda4) |>
#       pull(grupo_uni)
# 
#     filtro_coda5 <- dados_subgrupos |>
#       filter(cid == ind$coda5) |>
#       pull(grupo_uni)
# 
#     filtro_coda6 <- dados_subgrupos |>
#       filter(cid == ind$coda6) |>
#       pull(grupo_uni)
# 
#     cids_coda2 <- dados_subgrupos |>
#       filter(grupo_uni %in% c(filtro_coda2)) |>
#       pull(cid)
# 
#     cids_coda3 <- dados_subgrupos |>
#       filter(grupo_uni %in% c(filtro_coda3)) |>
#       pull(cid)
# 
#     cids_coda4 <- dados_subgrupos |>
#       filter(grupo_uni %in% c(filtro_coda4)) |>
#       pull(cid)
# 
#     cids_coda5 <- dados_subgrupos |>
#       filter(grupo_uni %in% c(filtro_coda5)) |>
#       pull(cid)
# 
#     cids_coda6 <- dados_subgrupos |>
#       filter(grupo_uni %in% c(filtro_coda6)) |>
#       pull(cid)
# 
#     if(ind$coda7 %in% c(cids_coda2, cids_coda3, cids_coda4, cids_coda5, cids_coda6)){
#       res7 <- 0
#       cid7 <- NA
#       if(ind$coda7 %in% cids_coda2) cid2 <- paste0(cid2, "-", ind$coda7)
#       else if(ind$coda7 %in% cids_coda3) cid3 <- paste0(cid3, "-", ind$coda7)
#       else if(ind$coda7 %in% cids_coda4) cid4 <- paste0(cid4, "-", ind$coda7)
#       else if(ind$coda7 %in% cids_coda5) cid5 <- paste0(cid5, "-", ind$coda7)
#       else if(ind$coda7 %in% cids_coda6) cid6 <- paste0(cid6, "-", ind$coda7)
#     } else{
#       res7 <- 1
#       cid7 <- ind$coda7
#     }
#   }
#   return(
#     list(
#       soma = c(ind$result2 + res3 + res4 + res5 + res6 + res7),
#       cids = c(cid2, cid3, cid4, cid5, cid6, cid7)
#     )
#    )
#   }
#  ) |>
#   transpose()
# 
# saveRDS(soma_cids, "soma_auxiliar/soma_cids.rds")
```

### Incluindo o número de malformações e as CIDs agrupadas, segundo a EUROCAT

```{r}
# soma e cids, segundo a eurocat

soma_cids_malf <- readRDS("soma_auxiliar/soma_cids.rds")

# vetor de somas de malformacoes

soma <- unlist(soma_cids_malf$soma)

# vetores de cids das malformacoes

cids <- matrix(
  unlist(soma_cids_malf$cids),
  ncol = 6, byrow = TRUE
 ) |> 
  as.data.frame()

# incluindo contagem e cids agrupadas de malformacoes

d_anom <- d_anom |> 
  # removendo malformacoes menores
  filter(ind_malf_maior != "só menor") |>
  mutate(
    n_malf = as.numeric(soma),
    cid2 = cids$V1,
    cid3 = cids$V2,
    cid4 = cids$V3,
    cid5 = cids$V4,
    cid6 = cids$V5,
    cid7 = cids$V6,
  ) |> 
  # identificando se a malformacao e unica ou multipla
  mutate(
    ind_malf = case_when(
      n_malf == 1 ~ "única",
      n_malf > 1 ~ "múltipla",
      TRUE ~ NA_character_
    )
  ) |>
  # corrigindo soma de malformacoes
  mutate(
    n_malf = case_when(
      cid3 == "NA-Q742" ~ 2, cid3 == "NA-Q369" ~ 3, cid3 == "NA-Q220" ~ 4,
      cid3 == "NA-Q059" & cid6 == "Q410" ~ 3, cid3 == "NA-Q059" & cid5 == "Q208" ~ 4,
      cid3 == "NA-Q059" & cid5 == "Q668" ~ 3 , cid3 == "NA-Q050" & cid5 == "Q753" ~ 3,
      cid3 == "NA-Q040-Q042" ~ 3, cid4 == "NA-Q647" & cid6 == "Q699" ~ 4,
      cid4 == "NA-Q647" & cid2 == "Q272" ~ 3, cid4 == "NA-742" ~ 3, cid5 == "NA-742" ~ 4,
      TRUE ~ n_malf
    )
  ) |>
  # corrigindo cids
  mutate(
    cid2 = case_when(
      cid3 == "NA-Q079" ~ "Q040-Q078-Q079",
      TRUE ~ cid2
    ),
    cid3 = case_when(
      cid3 == "NA-Q079" ~ NA_character_,
      TRUE ~ cid3
    )
  ) |>
  mutate(across(starts_with("cid"), ~ifelse(str_detect(.x, "NA"), str_sub(.x, start = 4), .x)))
```

### Total de RNs com malformações maiores únicas e malformações maiores múltiplas

```{r}
d_anom$ind_malf <- factor(
  d_anom$ind_malf,
  levels = c("única", "múltipla")
)

freq(
  d_anom$ind_malf,
  cum = FALSE,
  total = TRUE,
  na.last = FALSE,
  valid = TRUE
  ) |>
  kable(
    caption = "Tabela de frequências para o número de RNs com malformações maiores únicas e múltiplas.",
    digits = 4
  ) |>
  kableExtra::kable_styling(latex_options = "HOLD_position")
```

### Total de malformações

O número total verdadeiro de malformações é de 231.688.

```{r}
# total de malformacoes 

soma_malf <- sum(d_anom$n_malf, na.rm = TRUE)
```

\newpage

# 5. Medidas resumo de variáveis

Tabela com as principais medidas resumo das variáveis **número de consultas de pré-natal (`CONSPRENAT`)**, **idade da mãe (`IDADEMAE`)**, **peso ao nascer (`PESO`)** e **idade gestacional do parto (`SEMAGESTAC`)**, considerando somente as malformações congênitas maiores (únicas, múltiplas ou múltiplas em que constam malformações maiores e menores).

```{r}
vas_num <- d_anom |>  
  select(CONSPRENAT, IDADEMAE, PESO, SEMAGESTAC)

datasummary_skim(data = vas_num) |> 
  tinytable::theme_tt("tabular")
```

\newpage

# 6. Análise de frequências de variáveis

Tabelas de frequências para as variáveis **número de consultas de pré-natal (categórico)**, **escolaridade da mãe**, **estado civil da mãe**, **raça/cor da mãe**, **idade gestacional do parto (categórica)**, **tipo de gravidez**, **local de nascimento**, **tipo de parto**, **raça/cor do RN**, **sexo** e **grupo de Robson**, considerando somente as malformações congênitas maiores (únicas, múltiplas ou múltiplas em que constam malformações maiores e menores).

### Número de consultas de pré-natal

```{r}
d_anom$def_consultas <- factor(
  d_anom$def_consultas,
  levels = c("Nenhuma", "de 1 a 3", "de 4 a 6", "7 e mais")
)

freq(
  d_anom$def_consultas,
  cum = FALSE, total = TRUE,
  na.last = FALSE, valid = TRUE
  ) |> 
  kable(
    caption = "Tabela de frequências para número de consultas de pré-natal.",
    digits = 4
  ) |> 
  kableExtra::kable_styling(latex_options = "HOLD_position")
```

### Escolaridade da mãe

```{r}
d_anom$def_escol_mae <- factor(
  d_anom$def_escol_mae,
  levels = c("Nenhuma", "1 a 3 anos", "4 a 7 anos", "8 a 11 anos", "12 e mais")
)

freq(
  d_anom$def_escol_mae,
  cum = FALSE, total = TRUE,
  na.last = FALSE, valid = TRUE
  ) |> 
  kable(
    caption = "Tabela de frequências para anos de escolaridade da mãe.", 
    digits = 4
  ) |> 
  kableExtra::kable_styling(latex_options = "HOLD_position")
```

### Estado civil da mãe

```{r}
d_anom$def_est_civil <- factor(
  d_anom$def_est_civil,
  levels = c("Casado", "Separado Judic./Divorciado", "Solteiro", 
             "União consensual", "Viúvo")
)

freq(
  d_anom$def_est_civil,
  cum = FALSE, total = TRUE,
  na.last = FALSE, valid = TRUE
  ) |> 
  kable(
    caption = "Tabela de frequências para estado civil da mãe.", 
    digits = 4
  ) |> 
  kableExtra::kable_styling(latex_options = "HOLD_position")
```

### Raça/cor da mãe

```{r}
# recodificando variavel raca/cor da mãe

d_anom <- d_anom |> 
  mutate(
    racacor_mae = case_when(
    RACACORMAE == 1 ~ "Branca",
    RACACORMAE == 2 ~ "Preta",
    RACACORMAE == 3 ~ "Amarela",
    RACACORMAE == 4 ~ "Parda",
    RACACORMAE == 5 ~ "Indígena",
    TRUE ~ NA_character_
   )
  )

freq(
  d_anom$racacor_mae,
  cum = FALSE, total = TRUE,
  na.last = FALSE, valid = TRUE
  ) |> 
  kable(
    caption = "Tabela de frequências para raça/cor da mãe.", 
    digits = 4
  )|> 
  kableExtra::kable_styling(latex_options = "HOLD_position")
```

### Semana gestacional

```{r}
d_anom$def_gestacao <- factor(
  d_anom$def_gestacao,
  levels = c("Menos de 22 semanas", "22 a 27 semanas", "28 a 31 semanas", 
             "32 a 36 semanas","37 a 41 semanas", "42 semanas e mais")
)

freq( 
  d_anom$def_gestacao,
  cum = FALSE, total = TRUE,
  na.last = FALSE, valid = TRUE
  ) |> 
  kable(
    caption = "Tabela de frequências para idade gestacional.", 
    digits = 4
  ) |> 
  kableExtra::kable_styling(latex_options = "HOLD_position")
```

### Tipo de gravidez

```{r}
d_anom$def_gravidez <- factor(
  d_anom$def_gravidez,
  levels = c("Única", "Dupla", "Tripla ou mais")
)

freq(
  d_anom$def_gravidez,
  cum = FALSE, total = TRUE,
  na.last = FALSE, valid = TRUE
  ) |> 
  kable(
    caption = "Tabela de frequências para tipo de gravidez.", 
    digits = 4
  ) |> 
  kableExtra::kable_styling(latex_options = "HOLD_position")
```

### Local de nascimento

```{r}
d_anom$def_loc_nasc <- factor(
  d_anom$def_loc_nasc,
  levels = c("Domicílio", "Hospital", "Outro Estab. Saúde", "Outros")
)

freq(
  d_anom$def_loc_nasc,
  cum = FALSE, total = TRUE,
  na.last = FALSE, valid = TRUE
  ) |> 
  kable(
    caption = "Tabela de frequências para local de nascimento.", 
    digits = 4
  ) |> 
  kableExtra::kable_styling(latex_options = "HOLD_position")
```

### Tipo de parto

```{r}
d_anom$def_parto <- factor(
  d_anom$def_parto,
  levels = c("Cesáreo", "Vaginal")
)

freq(
  d_anom$def_parto,
  cum = FALSE, total = TRUE,
  na.last = FALSE, valid = TRUE
  ) |> 
  kable(
    caption = "Tabela de frequências para tipo de parto.", 
    digits = 4
  ) |> 
  kableExtra::kable_styling(latex_options = "HOLD_position")
```

### Raça/cor do RN

```{r}
d_anom$def_raca_cor <- factor(
  d_anom$def_raca_cor,
  levels = c("Amarela", "Branca", "Indígena", "Parda", "Preta")
)

freq(
  d_anom$def_raca_cor,
  cum = FALSE, total = TRUE,
  na.last = FALSE, valid = TRUE
  ) |> 
  kable(
    caption = "Tabela de frequências para raça/cor do recém-nascido.", 
    digits = 4
  ) |> 
  kableExtra::kable_styling(latex_options = "HOLD_position")
```

### Sexo do RN

```{r}
d_anom$def_sexo <- factor(
  d_anom$def_sexo,
  levels = c("Feminino", "Masculino")
)

freq(
  d_anom$def_sexo,
  cum = FALSE, total = TRUE,
  na.last = FALSE, valid = TRUE
  ) |> 
  kable(
    caption = "Tabela de frequências para sexo do recém-nascido.", 
    digits = 4
  ) |> 
  kableExtra::kable_styling(latex_options = "HOLD_position")
```

### Grupo de Robson

```{r}
d_anom$TPROBSON <- factor(
  d_anom$TPROBSON,
  levels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10")
)

freq(
  d_anom$TPROBSON,
  cum = FALSE, total = TRUE,
  na.last = FALSE, valid = TRUE
  ) |> 
  kable(
    caption = "Tabela de frequências para grupos de Robson.", 
    digits = 4
  ) |> 
  kableExtra::kable_styling(latex_options = "HOLD_position")
```

\newpage

# 7. Gráficos de prevalências das anomalias congênitas

Nesta seção, estão os gráficos de malformações congênitas por **ano**, por **ano e região** e por **ano e estado**.

Para calcular os percentuais por ano, foi dividido o total de malformações (únicas e múltiplas) por ano pelo número de nascidos vivos no mesmo ano. Para calcular os percentuais por ano e estado, foi feita a razão entre o total de malformações por ano e estado e o total de nascidos vivos no mesmo ano e estado. Para calcular os percentuais por ano e região, foi feita a razão entre o total de malformações por ano e região e o total de nascidos vivos no mesmo ano e região.

```{r}
# carregando dados nascidos 11-20

nascidos_por_ano <- fs::dir_ls("01.dados/nascidos/", glob = "*.csv")

dados_nascidos <- map(nascidos_por_ano, readr::read_csv2) |> 
  list_rbind() |> 
  select(`ano (nome)`, `localidade (nome)`, Ano) |> 
  rename(ano_nasc = `ano (nome)`, local = `localidade (nome)`, total = Ano) |> 
  mutate(
    ano_nasc = as.character(ano_nasc),
    nivel = case_when(
      local == "Brasil" ~ "país",
      (local == "Norte" | local == "Nordeste" | local == "Centro-Oeste" |
         local == "Sudeste" | local == "Sul") ~ "região",
      TRUE ~ "estado"
    )
  )

# renomeando nome dos estados

d_anom$res_NOME_UF <- recode(
  d_anom$res_NOME_UF,
  PARA = "Pará", ACRE = "Acre", PARAIBA = "Paraíba", GOIAS = "Goiás",
  `SAO PAULO` = "São Paulo", `SANTA CATARINA` = "Santa Catarina",
  `RIO GRANDE DO NORTE` = "Rio Grande do Norte", RONDONIA = "Rondônia",
  PERNAMBUCO = "Pernambuco", PIAUI = "Piauí", RORAIMA = "Roraima",
  AMAPA = "Amapá", PARANA = "Paraná", `ESPIRITO SANTO` = "Espírito Santo",
  BAHIA = "Bahia", `RIO GRANDE DO SUL` = "Rio Grande do Sul", AMAZONAS = "Amazonas",
  `MATO GROSSO` = "Mato Grosso", `MATO GROSSO DO SUL` = "Mato Grosso do Sul",
  TOCANTINS = "Tocantins", MARANHAO = "Maranhão", CEARA = "Ceará",
  ALAGOAS = "Alagoas", `MINAS GERAIS` = "Minas Gerais", SERGIPE = "Sergipe",
  `DISTRITO FEDERAL` = "Distrito Federal", `RIO DE JANEIRO` = "Rio de Janeiro"
)
```

### Por ano

```{r}
dados_nasc_ano <- dados_nascidos |> 
  # selecionando os totais de nascidos por ano
  filter(local == "Brasil") |> 
  select(-c(local, nivel))

malf_ano <- d_anom |> 
  mutate(ano_nasc = as.character(ano_nasc)) |> 
  group_by(ano_nasc) |> 
  # contabilizando o numero de malformacoes por ano
  summarise(n_casos = sum(n_malf))

malf_ano <- malf_ano |> 
  # unindo os dados de malformacoes maiores com os dados de nascidos
  left_join(dados_nasc_ano, by = "ano_nasc") |> 
  # calculando prevalencia de casos de malformacoes por ano, por 1000 nv
  mutate(prev = round((n_casos / total), 4) * 1000)
```

```{r}
ggplot(malf_ano, aes(x = ano_nasc, y = prev, 
                     fill = ifelse(ano_nasc == "2016", "destacada", "normal"))) + 
  # grafico de barras
  geom_col() + 
  theme_bw() + 
  labs(y = "Prevalence per 1,000 LB") + 
  scale_x_discrete(breaks = seq(from = 2011, to = 2020, by = 1)) +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 2)) +
  scale_fill_manual(breaks = c("destacada", "normal"), values = c("#f21a00", "#78b7c5")) +
  geom_label(aes(label = sprintf("%.2f", prev), hjust = 1.2), size = 7, color = "#000000") +
  theme(
    text = element_text(size = 20),
    axis.title.y = element_blank(),
    legend.position = "none", 
  ) +
  coord_flip()
```

### Por ano e região

```{r}
dados_nasc_ano_reg <- dados_nascidos |> 
  # selecionando os totais de nascidos por ano e regiao
  filter(nivel == "região" ) |> 
  select(-nivel)

malf_ano_reg <- d_anom |> 
  mutate(ano_nasc = as.character(ano_nasc)) |> 
  rename(local = res_REGIAO) |> 
  group_by(ano_nasc, local) |> 
  # contabilizando o numero de malformacoes por ano e regiao
  summarise(n_casos = sum(n_malf))

malf_ano_reg <- malf_ano_reg |> 
  # unindo os dados de anomalias com os dados de nascidos por ano e estado
  left_join(dados_nasc_ano_reg, by = c("ano_nasc", "local")) |> 
  mutate(
    local = case_when(
      local == "Norte" ~ "North", local == "Nordeste" ~ "Northeast",
      local == "Centro-Oeste" ~ "Midwest", local == "Sudeste" ~ "Southeast",
      local == "Sul" ~ "South",
      TRUE ~ NA_character_
    ),
    local = factor(local, levels = c("South", "Southeast", "Midwest", "Northeast", "North"))
  ) |> 
  # calculando prevalencia por 1000 nv
  mutate(prev = round(n_casos / total, 4) * 1000)
```

```{r}
ggplot(malf_ano_reg, aes(x = ano_nasc, y = local, fill = prev)) +
  # mapa de calor
  geom_tile() +
  geom_text(aes(label = sprintf("%.2f", prev)), color = "#000000", size = 5) +
  theme_bw() +
  scale_fill_gradientn(
    limits = c(4, 10.5), breaks = c(4, 6, 8, 10),
    colours = wes_palette("Zissou1", 100, type = "continuous")
  ) + 
  scale_x_discrete(breaks = seq(from = 2011, to = 2020, by = 1)) +
  labs(y = "", fill = "Prevalence per \n1,000 LB") +
  theme(
    text = element_text(size = 20),
    axis.title.x = element_blank(),
    legend.position = "bottom",
    legend.key.width = unit(2, 'cm')
  )
```

### Por ano e estado

```{r}
dados_nasc_ano_uf <- dados_nascidos |> 
  # selecionando os totais de nascidos por ano e regiao
  filter(nivel == "estado" ) |> 
  select(-nivel)

malf_ano_uf <- d_anom |> 
  mutate(ano_nasc = as.character(ano_nasc)) |> 
  rename(local = res_NOME_UF) |> 
  group_by(ano_nasc, local) |> 
  # contabilizando o numero de malformacoes por ano e regiao
  summarise(n_casos = sum(n_malf))

malf_ano_uf <- malf_ano_uf |> 
  # unindo os dados de anomalias com os dados de nascidos por ano e estado
  left_join(dados_nasc_ano_uf, by = c("ano_nasc", "local")) |> 
  mutate(
    # organizando os estados por regiao
    local = factor(
      local,
      levels = c(
        "Rio Grande do Sul", "Santa Catarina", "Paraná", #s
        "São Paulo", "Rio de Janeiro", "Espírito Santo", "Minas Gerais", #se
        "Distrito Federal", "Goiás", "Mato Grosso", "Mato Grosso do Sul", #co
        "Bahia", "Sergipe", "Alagoas", "Pernambuco", "Paraíba", 
        "Rio Grande do Norte", "Ceará", "Piauí", "Maranhão", #ne
        "Tocantins", "Pará", "Amapá", "Roraima", "Amazonas", "Rondônia", "Acre" #n
      )
    ),
    # calculando prevalencia por 1000 nv
    prev = round(n_casos / total, 4) * 1000
  )
```

```{r}
ggplot(malf_ano_uf, aes(x = ano_nasc, y = local, fill = prev)) +
  # mapa de calor
  geom_tile() +
  geom_text(aes(label = sprintf("%.2f", prev)), color = "#000000", size = 5) +
  theme_bw() +
  scale_fill_gradientn(
    limits = c(1, 14), breaks = c(1, 4, 7, 10, 13),
    colours = wes_palette("Zissou1", 100, type = "continuous")
  ) +  
  scale_x_discrete(breaks = seq(from = 2011, to = 2020, by = 1)) +
  labs(y = "", fill = "Prevalence per \n1,000 LB") +
  theme(
    text = element_text(size = 20),
    axis.title.x = element_blank(),
    legend.position = "bottom",
    legend.key.width = unit(2, 'cm')
  )
```

\newpage

# 8. Frequências das anomalias congênitas

Nesta seção, encontram-se as tabelas de frequências e gráficos de barras das malformações congênitas prioritárias, segundo grupos e subgrupos definidos pela EUROCAT.

Para calcular as frequências (percentuais) das malformações congênitas, foi feita a razão entre o número de ocorrência de cada malformação e o total (soma) de ocorrência de todas as malformações. Para calcular as frequências (percentuais) dos grupos de malformações congênitas, o raciocínio foi análogo.

### Tabela de frequências para as malformações congênitas

Código omitido. Verificar no arquivo `anom.Rmd`.

Resultado omitido. Foi gerado o arquivo `tab_freqs.xlsx`.

```{r echo=FALSE}
# classificando cids multiplas em uma unica cid, segundo a eurocat

d_anom <- d_anom |>
  mutate(
    # cid2
    cf2 = case_when(
      str_length(cid2) > 4 & str_detect(cid2, "Q000") ~ "Q000",
      str_length(cid2) > 4 & str_detect(cid2, "Q01X") ~ "Q01X",
      str_length(cid2) > 4 & str_detect(cid2, "Q02X") ~ "Q02X",
      str_length(cid2) > 4 & str_detect(cid2, "Q039") ~ "Q039",
      str_length(cid2) > 4 & str_detect(cid2, "Q040") ~ "Q040",
      str_length(cid2) > 4 & str_detect(cid2, "Q042") ~ "Q042",
      str_length(cid2) > 4 & str_detect(cid2, "Q045") ~ "Q045",
      str_length(cid2) > 4 & str_detect(cid2, "Q046") ~ "Q046",
      str_length(cid2) > 4 & str_detect(cid2, "Q05X") ~ "Q05X",
      str_length(cid2) > 4 & str_detect(cid2, "Q01X") ~ "Q01X",
      str_length(cid2) > 4 & str_detect(cid2, "Q060") ~ "Q060",
      str_length(cid2) > 4 & str_detect(cid2, "Q062") ~ "Q062",
      str_length(cid2) > 4 & str_detect(cid2, "Q064") ~ "Q064",
      str_length(cid2) > 4 & str_detect(cid2, "Q104") ~ "Q104",
      str_length(cid2) > 4 & str_detect(cid2, "Q110") ~ "Q110",
      str_length(cid2) > 4 & str_detect(cid2, "Q111") ~ "Q111",
      str_length(cid2) > 4 & str_detect(cid2, "Q112") ~ "Q112",
      str_length(cid2) > 4 & str_detect(cid2, "Q113") ~ "Q120",
      str_length(cid2) > 4 & str_detect(cid2, "Q132") ~ "Q132",
      str_length(cid2) > 4 & str_detect(cid2, "Q150") ~ "Q150",
      str_length(cid2) > 4 & str_detect(cid2, "Q160") ~ "Q160",
      str_length(cid2) > 4 & str_detect(cid2, "Q200") ~ "Q200",
      str_length(cid2) > 4 & str_detect(cid2, "Q201") ~ "Q201",
      str_length(cid2) > 4 & str_detect(cid2, "Q202") ~ "Q202",
      str_length(cid2) > 4 & str_detect(cid2, "Q203") ~ "Q203",
      str_length(cid2) > 4 & str_detect(cid2, "Q204") ~ "Q204",
      str_length(cid2) > 4 & str_detect(cid2, "Q205") ~ "Q205",
      str_length(cid2) > 4 & str_detect(cid2, "Q206") ~ "Q206",
      str_length(cid2) > 4 & str_detect(cid2, "Q210") ~ "Q210",
      str_length(cid2) > 4 & str_detect(cid2, "Q211") ~ "Q211",
      str_length(cid2) > 4 & str_detect(cid2, "Q212") ~ "Q212",
      str_length(cid2) > 4 & str_detect(cid2, "Q213") ~ "Q213",
      str_length(cid2) > 4 & str_detect(cid2, "Q214") ~ "Q214",
      str_length(cid2) > 4 & str_detect(cid2, "Q220") ~ "Q220",
      str_length(cid2) > 4 & str_detect(cid2, "Q224") ~ "Q224",
      str_length(cid2) > 4 & str_detect(cid2, "Q230") ~ "Q230",
      str_length(cid2) > 4 & str_detect(cid2, "Q240") ~ "Q240",
      str_length(cid2) > 4 & str_detect(cid2, "Q242") ~ "Q242",
      str_length(cid2) > 4 & str_detect(cid2, "Q243") ~ "Q243",
      str_length(cid2) > 4 & str_detect(cid2, "Q244") ~ "Q244",
      str_length(cid2) > 4 & str_detect(cid2, "Q245") ~ "Q245",
      str_length(cid2) > 4 & str_detect(cid2, "Q251") ~ "Q251",
      str_length(cid2) > 4 & str_detect(cid2, "Q255") ~ "Q255",
      str_length(cid2) > 4 & str_detect(cid2, "Q260") ~ "Q260",
      str_length(cid2) > 4 & str_detect(cid2, "Q262") ~ "Q262",
      str_length(cid2) > 4 & str_detect(cid2, "Q265") ~ "Q265",
      str_length(cid2) > 4 & str_detect(cid2, "Q266") ~ "Q266",
      str_length(cid2) > 4 & str_detect(cid2, "Q300") ~ "Q300",
      str_length(cid2) > 4 & str_detect(cid2, "Q301") ~ "Q301",
      str_length(cid2) > 4 & str_detect(cid2, "Q302") ~ "Q302",
      str_length(cid2) > 4 & str_detect(cid2, "Q313") ~ "Q313",
      str_length(cid2) > 4 & str_detect(cid2, "Q322") ~ "Q322",
      str_length(cid2) > 4 & str_detect(cid2, "Q323") ~ "Q323",
      str_length(cid2) > 4 & str_detect(cid2, "Q330") ~ "Q330",
      str_length(cid2) > 4 & str_detect(cid2, "Q332") ~ "Q332",
      str_length(cid2) > 4 & str_detect(cid2, "Q333") ~ "Q333",
      str_length(cid2) > 4 & str_detect(cid2, "Q334") ~ "Q334",
      str_length(cid2) > 4 & str_detect(cid2, "Q335") ~ "Q335",
      str_length(cid2) > 4 & str_detect(cid2, "Q336") ~ "Q336",
      str_length(cid2) > 4 & str_detect(cid2, "Q340") ~ "Q340",
      str_length(cid2) > 4 & str_detect(cid2, "Q790") ~ "Q790",
      str_length(cid2) > 4 & str_detect(cid2, "Q35X") ~ "Q35X",
      str_length(cid2) > 4 & str_detect(cid2, "Q042") ~ "Q042",
      str_length(cid2) > 4 & str_detect(cid2, "Q37X") ~ "Q37X",
      str_length(cid2) > 4 & str_detect(cid2, "Q042") ~ "Q042",
      str_length(cid2) > 4 & str_detect(cid2, "Q383") ~ "Q383",
      str_length(cid2) > 4 & str_detect(cid2, "Q384") ~ "Q383",
      str_length(cid2) > 4 & str_detect(cid2, "Q387") ~ "Q387",
      str_length(cid2) > 4 & str_detect(cid2, "Q390") ~ "Q390",
      str_length(cid2) > 4 & str_detect(cid2, "Q391") ~ "Q391",
      str_length(cid2) > 4 & str_detect(cid2, "Q392") ~ "Q392",
      str_length(cid2) > 4 & str_detect(cid2, "Q393") ~ "Q393",
      str_length(cid2) > 4 & str_detect(cid2, "Q396") ~ "Q396",
      str_length(cid2) > 4 & str_detect(cid2, "Q403") ~ "Q403",
      str_length(cid2) > 4 & str_detect(cid2, "Q410") ~ "Q410",
      str_length(cid2) > 4 & str_detect(cid2, "Q423") ~ "Q423",
      str_length(cid2) > 4 & str_detect(cid2, "Q428") ~ "Q428",
      str_length(cid2) > 4 & str_detect(cid2, "Q431") ~ "Q431",
      str_length(cid2) > 4 & str_detect(cid2, "Q433") ~ "Q433",
      str_length(cid2) > 4 & str_detect(cid2, "Q434") ~ "Q434",
      str_length(cid2) > 4 & str_detect(cid2, "Q435") ~ "Q435",
      str_length(cid2) > 4 & str_detect(cid2, "Q436") ~ "Q436",
      str_length(cid2) > 4 & str_detect(cid2, "Q440") ~ "Q440",
      str_length(cid2) > 4 & str_detect(cid2, "Q442") ~ "Q442",
      str_length(cid2) > 4 & str_detect(cid2, "Q446") ~ "Q446",
      str_length(cid2) > 4 & str_detect(cid2, "Q451") ~ "Q451",
      str_length(cid2) > 4 & str_detect(cid2, "Q422") ~ "Q422",
      str_length(cid2) > 4 & str_detect(cid2, "Q500") ~ "Q500",
      str_length(cid2) > 4 & str_detect(cid2, "Q501") ~ "Q501",
      str_length(cid2) > 4 & str_detect(cid2, "Q502") ~ "Q502",
      str_length(cid2) > 4 & str_detect(cid2, "Q505") ~ "Q505",
      str_length(cid2) > 4 & str_detect(cid2, "Q510") ~ "Q510",
      str_length(cid2) > 4 & str_detect(cid2, "Q513") ~ "Q513",
      str_length(cid2) > 4 & str_detect(cid2, "Q516") ~ "Q516",
      str_length(cid2) > 4 & str_detect(cid2, "Q517") ~ "Q517",
      str_length(cid2) > 4 & str_detect(cid2, "Q520") ~ "Q520",
      str_length(cid2) > 4 & str_detect(cid2, "Q521") ~ "Q521",
      str_length(cid2) > 4 & str_detect(cid2, "Q522") ~ "Q522",
      str_length(cid2) > 4 & str_detect(cid2, "Q526") ~ "Q526",
      str_length(cid2) > 4 & str_detect(cid2, "Q527") ~ "Q527",
      str_length(cid2) > 4 & str_detect(cid2, "Q549") ~ "Q549",
      str_length(cid2) > 4 & str_detect(cid2, "Q550") ~ "Q550",
      str_length(cid2) > 4 & str_detect(cid2, "Q553") ~ "Q553",
      str_length(cid2) > 4 & str_detect(cid2, "Q555") ~ "Q555",
      str_length(cid2) > 4 & str_detect(cid2, "Q560") ~ "Q560",
      str_length(cid2) > 4 & str_detect(cid2, "Q600") ~ "Q600",
      str_length(cid2) > 4 & str_detect(cid2, "Q601") ~ "Q601",
      str_length(cid2) > 4 & str_detect(cid2, "Q603") ~ "Q603",
      str_length(cid2) > 4 & str_detect(cid2, "Q604") ~ "Q604",
      str_length(cid2) > 4 & str_detect(cid2, "Q613") ~ "Q613",
      str_length(cid2) > 4 & str_detect(cid2, "Q614") ~ "Q614",
      str_length(cid2) > 4 & str_detect(cid2, "Q620") ~ "Q620",
      str_length(cid2) > 4 & str_detect(cid2, "Q624") ~ "Q624",
      str_length(cid2) > 4 & str_detect(cid2, "Q625") ~ "Q625",
      str_length(cid2) > 4 & str_detect(cid2, "Q630") ~ "Q630",
      str_length(cid2) > 4 & str_detect(cid2, "Q631") ~ "Q631",
      str_length(cid2) > 4 & str_detect(cid2, "Q632") ~ "Q632",
      str_length(cid2) > 4 & str_detect(cid2, "Q640") ~ "Q640",
      str_length(cid2) > 4 & str_detect(cid2, "Q641") ~ "Q642",
      str_length(cid2) > 4 & str_detect(cid2, "Q644") ~ "Q645",
      str_length(cid2) > 4 & str_detect(cid2, "Q646") ~ "Q646",
      str_length(cid2) > 4 & str_detect(cid2, "Q652") ~ "Q652",
      str_length(cid2) > 4 & str_detect(cid2, "Q66X") ~ "Q66X",
      str_length(cid2) > 4 & str_detect(cid2, "Q69X") ~ "Q69X",
      str_length(cid2) > 4 & str_detect(cid2, "Q709") ~ "Q709",
      str_length(cid2) > 4 & str_detect(cid2, "Q716") ~ "Q716",
      str_length(cid2) > 4 & str_detect(cid2, "Q718") ~ "Q718",
      str_length(cid2) > 4 & str_detect(cid2, "Q728") ~ "Q728",
      str_length(cid2) > 4 & str_detect(cid2, "Q743") ~ "Q743",
      str_length(cid2) > 4 & str_detect(cid2, "Q750") ~ "Q750",
      str_length(cid2) > 4 & str_detect(cid2, "Q751") ~ "Q751",
      str_length(cid2) > 4 & str_detect(cid2, "Q770") ~ "Q770",
      str_length(cid2) > 4 & str_detect(cid2, "Q771") ~ "Q771",
      str_length(cid2) > 4 & str_detect(cid2, "Q772") ~ "Q772",
      str_length(cid2) > 4 & str_detect(cid2, "Q773") ~ "Q773",
      str_length(cid2) > 4 & str_detect(cid2, "Q775") ~ "Q775",
      str_length(cid2) > 4 & str_detect(cid2, "Q776") ~ "Q776",
      str_length(cid2) > 4 & str_detect(cid2, "Q777") ~ "Q777",
      str_length(cid2) > 4 & str_detect(cid2, "Q780") ~ "Q780",
      str_length(cid2) > 4 & str_detect(cid2, "Q781") ~ "Q781",
      str_length(cid2) > 4 & str_detect(cid2, "Q782") ~ "Q782",
      str_length(cid2) > 4 & str_detect(cid2, "Q783") ~ "Q783",
      str_length(cid2) > 4 & str_detect(cid2, "Q784") ~ "Q784",
      str_length(cid2) > 4 & str_detect(cid2, "Q785") ~ "Q785",
      str_length(cid2) > 4 & str_detect(cid2, "Q786") ~ "Q786",
      str_length(cid2) > 4 & str_detect(cid2, "Q792") ~ "Q792",
      str_length(cid2) > 4 & str_detect(cid2, "Q793") ~ "Q793",
      str_length(cid2) > 4 & str_detect(cid2, "Q794") ~ "Q794",
      str_length(cid2) > 4 & str_detect(cid2, "Q809") ~ "Q809",
      str_length(cid2) > 4 & str_detect(cid2, "Q819") ~ "Q819",
      str_length(cid2) > 4 & str_detect(cid2, "Q820") ~ "Q820",
      str_length(cid2) > 4 & str_detect(cid2, "Q821") ~ "Q821",
      str_length(cid2) > 4 & str_detect(cid2, "Q822") ~ "Q822",
      str_length(cid2) > 4 & str_detect(cid2, "Q823") ~ "Q823",
      str_length(cid2) > 4 & str_detect(cid2, "Q824") ~ "Q824",
      str_length(cid2) > 4 & str_detect(cid2, "Q860") ~ "Q860",
      str_length(cid2) > 4 & str_detect(cid2, "Q861") ~ "Q861",
      str_length(cid2) > 4 & str_detect(cid2, "Q862") ~ "Q862",
      TRUE ~ cid2
    ),
    # cid3
    cf3 = case_when(
      str_length(cid3) > 4 & str_detect(cid3, "Q000") ~ "Q000",
      str_length(cid3) > 4 & str_detect(cid3, "Q01X") ~ "Q01X",
      str_length(cid3) > 4 & str_detect(cid3, "Q02X") ~ "Q02X",
      str_length(cid3) > 4 & str_detect(cid3, "Q039") ~ "Q039",
      str_length(cid3) > 4 & str_detect(cid3, "Q040") ~ "Q040",
      str_length(cid3) > 4 & str_detect(cid3, "Q042") ~ "Q042",
      str_length(cid3) > 4 & str_detect(cid3, "Q045") ~ "Q045",
      str_length(cid3) > 4 & str_detect(cid3, "Q046") ~ "Q046",
      str_length(cid3) > 4 & str_detect(cid3, "Q05X") ~ "Q05X",
      str_length(cid3) > 4 & str_detect(cid3, "Q01X") ~ "Q01X",
      str_length(cid3) > 4 & str_detect(cid3, "Q060") ~ "Q060",
      str_length(cid3) > 4 & str_detect(cid3, "Q062") ~ "Q062",
      str_length(cid3) > 4 & str_detect(cid3, "Q064") ~ "Q064",
      str_length(cid3) > 4 & str_detect(cid3, "Q104") ~ "Q104",
      str_length(cid3) > 4 & str_detect(cid3, "Q110") ~ "Q110",
      str_length(cid3) > 4 & str_detect(cid3, "Q111") ~ "Q111",
      str_length(cid3) > 4 & str_detect(cid3, "Q112") ~ "Q112",
      str_length(cid3) > 4 & str_detect(cid3, "Q113") ~ "Q120",
      str_length(cid3) > 4 & str_detect(cid3, "Q132") ~ "Q132",
      str_length(cid3) > 4 & str_detect(cid3, "Q150") ~ "Q150",
      str_length(cid3) > 4 & str_detect(cid3, "Q160") ~ "Q160",
      str_length(cid3) > 4 & str_detect(cid3, "Q200") ~ "Q200",
      str_length(cid3) > 4 & str_detect(cid3, "Q201") ~ "Q201",
      str_length(cid3) > 4 & str_detect(cid3, "Q202") ~ "Q202",
      str_length(cid3) > 4 & str_detect(cid3, "Q203") ~ "Q203",
      str_length(cid3) > 4 & str_detect(cid3, "Q204") ~ "Q204",
      str_length(cid3) > 4 & str_detect(cid3, "Q205") ~ "Q205",
      str_length(cid3) > 4 & str_detect(cid3, "Q206") ~ "Q206",
      str_length(cid3) > 4 & str_detect(cid3, "Q210") ~ "Q210",
      str_length(cid3) > 4 & str_detect(cid3, "Q211") ~ "Q211",
      str_length(cid3) > 4 & str_detect(cid3, "Q212") ~ "Q212",
      str_length(cid3) > 4 & str_detect(cid3, "Q213") ~ "Q213",
      str_length(cid3) > 4 & str_detect(cid3, "Q214") ~ "Q214",
      str_length(cid3) > 4 & str_detect(cid3, "Q220") ~ "Q220",
      str_length(cid3) > 4 & str_detect(cid3, "Q224") ~ "Q224",
      str_length(cid3) > 4 & str_detect(cid3, "Q230") ~ "Q230",
      str_length(cid3) > 4 & str_detect(cid3, "Q240") ~ "Q240",
      str_length(cid3) > 4 & str_detect(cid3, "Q242") ~ "Q242",
      str_length(cid3) > 4 & str_detect(cid3, "Q243") ~ "Q243",
      str_length(cid3) > 4 & str_detect(cid3, "Q244") ~ "Q244",
      str_length(cid3) > 4 & str_detect(cid3, "Q245") ~ "Q245",
      str_length(cid3) > 4 & str_detect(cid3, "Q251") ~ "Q251",
      str_length(cid3) > 4 & str_detect(cid3, "Q255") ~ "Q255",
      str_length(cid3) > 4 & str_detect(cid3, "Q260") ~ "Q260",
      str_length(cid3) > 4 & str_detect(cid3, "Q262") ~ "Q262",
      str_length(cid3) > 4 & str_detect(cid3, "Q265") ~ "Q265",
      str_length(cid3) > 4 & str_detect(cid3, "Q266") ~ "Q266",
      str_length(cid3) > 4 & str_detect(cid3, "Q300") ~ "Q300",
      str_length(cid3) > 4 & str_detect(cid3, "Q301") ~ "Q301",
      str_length(cid3) > 4 & str_detect(cid3, "Q302") ~ "Q302",
      str_length(cid3) > 4 & str_detect(cid3, "Q313") ~ "Q313",
      str_length(cid3) > 4 & str_detect(cid3, "Q322") ~ "Q322",
      str_length(cid3) > 4 & str_detect(cid3, "Q323") ~ "Q323",
      str_length(cid3) > 4 & str_detect(cid3, "Q330") ~ "Q330",
      str_length(cid3) > 4 & str_detect(cid3, "Q332") ~ "Q332",
      str_length(cid3) > 4 & str_detect(cid3, "Q333") ~ "Q333",
      str_length(cid3) > 4 & str_detect(cid3, "Q334") ~ "Q334",
      str_length(cid3) > 4 & str_detect(cid3, "Q335") ~ "Q335",
      str_length(cid3) > 4 & str_detect(cid3, "Q336") ~ "Q336",
      str_length(cid3) > 4 & str_detect(cid3, "Q340") ~ "Q340",
      str_length(cid3) > 4 & str_detect(cid3, "Q790") ~ "Q790",
      str_length(cid3) > 4 & str_detect(cid3, "Q35X") ~ "Q35X",
      str_length(cid3) > 4 & str_detect(cid3, "Q042") ~ "Q042",
      str_length(cid3) > 4 & str_detect(cid3, "Q37X") ~ "Q37X",
      str_length(cid3) > 4 & str_detect(cid3, "Q042") ~ "Q042",
      str_length(cid3) > 4 & str_detect(cid3, "Q383") ~ "Q383",
      str_length(cid3) > 4 & str_detect(cid3, "Q384") ~ "Q383",
      str_length(cid3) > 4 & str_detect(cid3, "Q387") ~ "Q387",
      str_length(cid3) > 4 & str_detect(cid3, "Q390") ~ "Q390",
      str_length(cid3) > 4 & str_detect(cid3, "Q391") ~ "Q391",
      str_length(cid3) > 4 & str_detect(cid3, "Q392") ~ "Q392",
      str_length(cid3) > 4 & str_detect(cid3, "Q393") ~ "Q393",
      str_length(cid3) > 4 & str_detect(cid3, "Q396") ~ "Q396",
      str_length(cid3) > 4 & str_detect(cid3, "Q403") ~ "Q403",
      str_length(cid3) > 4 & str_detect(cid3, "Q410") ~ "Q410",
      str_length(cid3) > 4 & str_detect(cid3, "Q423") ~ "Q423",
      str_length(cid3) > 4 & str_detect(cid3, "Q428") ~ "Q428",
      str_length(cid3) > 4 & str_detect(cid3, "Q431") ~ "Q431",
      str_length(cid3) > 4 & str_detect(cid3, "Q433") ~ "Q433",
      str_length(cid3) > 4 & str_detect(cid3, "Q434") ~ "Q434",
      str_length(cid3) > 4 & str_detect(cid3, "Q435") ~ "Q435",
      str_length(cid3) > 4 & str_detect(cid3, "Q436") ~ "Q436",
      str_length(cid3) > 4 & str_detect(cid3, "Q440") ~ "Q440",
      str_length(cid3) > 4 & str_detect(cid3, "Q442") ~ "Q442",
      str_length(cid3) > 4 & str_detect(cid3, "Q446") ~ "Q446",
      str_length(cid3) > 4 & str_detect(cid3, "Q451") ~ "Q451",
      str_length(cid3) > 4 & str_detect(cid3, "Q422") ~ "Q422",
      str_length(cid3) > 4 & str_detect(cid3, "Q500") ~ "Q500",
      str_length(cid3) > 4 & str_detect(cid3, "Q501") ~ "Q501",
      str_length(cid3) > 4 & str_detect(cid3, "Q502") ~ "Q502",
      str_length(cid3) > 4 & str_detect(cid3, "Q505") ~ "Q505",
      str_length(cid3) > 4 & str_detect(cid3, "Q510") ~ "Q510",
      str_length(cid3) > 4 & str_detect(cid3, "Q513") ~ "Q513",
      str_length(cid3) > 4 & str_detect(cid3, "Q516") ~ "Q516",
      str_length(cid3) > 4 & str_detect(cid3, "Q517") ~ "Q517",
      str_length(cid3) > 4 & str_detect(cid3, "Q520") ~ "Q520",
      str_length(cid3) > 4 & str_detect(cid3, "Q521") ~ "Q521",
      str_length(cid3) > 4 & str_detect(cid3, "Q522") ~ "Q522",
      str_length(cid3) > 4 & str_detect(cid3, "Q526") ~ "Q526",
      str_length(cid3) > 4 & str_detect(cid3, "Q527") ~ "Q527",
      str_length(cid3) > 4 & str_detect(cid3, "Q549") ~ "Q549",
      str_length(cid3) > 4 & str_detect(cid3, "Q550") ~ "Q550",
      str_length(cid3) > 4 & str_detect(cid3, "Q553") ~ "Q553",
      str_length(cid3) > 4 & str_detect(cid3, "Q555") ~ "Q555",
      str_length(cid3) > 4 & str_detect(cid3, "Q560") ~ "Q560",
      str_length(cid3) > 4 & str_detect(cid3, "Q600") ~ "Q600",
      str_length(cid3) > 4 & str_detect(cid3, "Q601") ~ "Q601",
      str_length(cid3) > 4 & str_detect(cid3, "Q603") ~ "Q603",
      str_length(cid3) > 4 & str_detect(cid3, "Q604") ~ "Q604",
      str_length(cid3) > 4 & str_detect(cid3, "Q613") ~ "Q613",
      str_length(cid3) > 4 & str_detect(cid3, "Q614") ~ "Q614",
      str_length(cid3) > 4 & str_detect(cid3, "Q620") ~ "Q620",
      str_length(cid3) > 4 & str_detect(cid3, "Q624") ~ "Q624",
      str_length(cid3) > 4 & str_detect(cid3, "Q625") ~ "Q625",
      str_length(cid3) > 4 & str_detect(cid3, "Q630") ~ "Q630",
      str_length(cid3) > 4 & str_detect(cid3, "Q631") ~ "Q631",
      str_length(cid3) > 4 & str_detect(cid3, "Q632") ~ "Q632",
      str_length(cid3) > 4 & str_detect(cid3, "Q640") ~ "Q640",
      str_length(cid3) > 4 & str_detect(cid3, "Q641") ~ "Q642",
      str_length(cid3) > 4 & str_detect(cid3, "Q644") ~ "Q645",
      str_length(cid3) > 4 & str_detect(cid3, "Q646") ~ "Q646",
      str_length(cid3) > 4 & str_detect(cid3, "Q652") ~ "Q652",
      str_length(cid3) > 4 & str_detect(cid3, "Q66X") ~ "Q66X",
      str_length(cid3) > 4 & str_detect(cid3, "Q69X") ~ "Q69X",
      str_length(cid3) > 4 & str_detect(cid3, "Q709") ~ "Q709",
      str_length(cid3) > 4 & str_detect(cid3, "Q716") ~ "Q716",
      str_length(cid3) > 4 & str_detect(cid3, "Q718") ~ "Q718",
      str_length(cid3) > 4 & str_detect(cid3, "Q728") ~ "Q728",
      str_length(cid3) > 4 & str_detect(cid3, "Q743") ~ "Q743",
      str_length(cid3) > 4 & str_detect(cid3, "Q750") ~ "Q750",
      str_length(cid3) > 4 & str_detect(cid3, "Q751") ~ "Q751",
      str_length(cid3) > 4 & str_detect(cid3, "Q770") ~ "Q770",
      str_length(cid3) > 4 & str_detect(cid3, "Q771") ~ "Q771",
      str_length(cid3) > 4 & str_detect(cid3, "Q772") ~ "Q772",
      str_length(cid3) > 4 & str_detect(cid3, "Q773") ~ "Q773",
      str_length(cid3) > 4 & str_detect(cid3, "Q775") ~ "Q775",
      str_length(cid3) > 4 & str_detect(cid3, "Q776") ~ "Q776",
      str_length(cid3) > 4 & str_detect(cid3, "Q777") ~ "Q777",
      str_length(cid3) > 4 & str_detect(cid3, "Q780") ~ "Q780",
      str_length(cid3) > 4 & str_detect(cid3, "Q781") ~ "Q781",
      str_length(cid3) > 4 & str_detect(cid3, "Q782") ~ "Q782",
      str_length(cid3) > 4 & str_detect(cid3, "Q783") ~ "Q783",
      str_length(cid3) > 4 & str_detect(cid3, "Q784") ~ "Q784",
      str_length(cid3) > 4 & str_detect(cid3, "Q785") ~ "Q785",
      str_length(cid3) > 4 & str_detect(cid3, "Q786") ~ "Q786",
      str_length(cid3) > 4 & str_detect(cid3, "Q792") ~ "Q792",
      str_length(cid3) > 4 & str_detect(cid3, "Q793") ~ "Q793",
      str_length(cid3) > 4 & str_detect(cid3, "Q794") ~ "Q794",
      str_length(cid3) > 4 & str_detect(cid3, "Q809") ~ "Q809",
      str_length(cid3) > 4 & str_detect(cid3, "Q819") ~ "Q819",
      str_length(cid3) > 4 & str_detect(cid3, "Q820") ~ "Q820",
      str_length(cid3) > 4 & str_detect(cid3, "Q821") ~ "Q821",
      str_length(cid3) > 4 & str_detect(cid3, "Q822") ~ "Q822",
      str_length(cid3) > 4 & str_detect(cid3, "Q823") ~ "Q823",
      str_length(cid3) > 4 & str_detect(cid3, "Q824") ~ "Q824",
      str_length(cid3) > 4 & str_detect(cid3, "Q860") ~ "Q860",
      str_length(cid3) > 4 & str_detect(cid3, "Q861") ~ "Q861",
      str_length(cid3) > 4 & str_detect(cid3, "Q862") ~ "Q862",
      TRUE ~ cid3
    ),
    # cid4
    cf4 = case_when(
      str_length(cid4) > 4 & str_detect(cid4, "Q000") ~ "Q000",
      str_length(cid4) > 4 & str_detect(cid4, "Q01X") ~ "Q01X",
      str_length(cid4) > 4 & str_detect(cid4, "Q02X") ~ "Q02X",
      str_length(cid4) > 4 & str_detect(cid4, "Q039") ~ "Q039",
      str_length(cid4) > 4 & str_detect(cid4, "Q040") ~ "Q040",
      str_length(cid4) > 4 & str_detect(cid4, "Q042") ~ "Q042",
      str_length(cid4) > 4 & str_detect(cid4, "Q045") ~ "Q045",
      str_length(cid4) > 4 & str_detect(cid4, "Q046") ~ "Q046",
      str_length(cid4) > 4 & str_detect(cid4, "Q05X") ~ "Q05X",
      str_length(cid4) > 4 & str_detect(cid4, "Q01X") ~ "Q01X",
      str_length(cid4) > 4 & str_detect(cid4, "Q060") ~ "Q060",
      str_length(cid4) > 4 & str_detect(cid4, "Q062") ~ "Q062",
      str_length(cid4) > 4 & str_detect(cid4, "Q064") ~ "Q064",
      str_length(cid4) > 4 & str_detect(cid4, "Q104") ~ "Q104",
      str_length(cid4) > 4 & str_detect(cid4, "Q110") ~ "Q110",
      str_length(cid4) > 4 & str_detect(cid4, "Q111") ~ "Q111",
      str_length(cid4) > 4 & str_detect(cid4, "Q112") ~ "Q112",
      str_length(cid4) > 4 & str_detect(cid4, "Q113") ~ "Q120",
      str_length(cid4) > 4 & str_detect(cid4, "Q132") ~ "Q132",
      str_length(cid4) > 4 & str_detect(cid4, "Q150") ~ "Q150",
      str_length(cid4) > 4 & str_detect(cid4, "Q160") ~ "Q160",
      str_length(cid4) > 4 & str_detect(cid4, "Q200") ~ "Q200",
      str_length(cid4) > 4 & str_detect(cid4, "Q201") ~ "Q201",
      str_length(cid4) > 4 & str_detect(cid4, "Q202") ~ "Q202",
      str_length(cid4) > 4 & str_detect(cid4, "Q203") ~ "Q203",
      str_length(cid4) > 4 & str_detect(cid4, "Q204") ~ "Q204",
      str_length(cid4) > 4 & str_detect(cid4, "Q205") ~ "Q205",
      str_length(cid4) > 4 & str_detect(cid4, "Q206") ~ "Q206",
      str_length(cid4) > 4 & str_detect(cid4, "Q210") ~ "Q210",
      str_length(cid4) > 4 & str_detect(cid4, "Q211") ~ "Q211",
      str_length(cid4) > 4 & str_detect(cid4, "Q212") ~ "Q212",
      str_length(cid4) > 4 & str_detect(cid4, "Q213") ~ "Q213",
      str_length(cid4) > 4 & str_detect(cid4, "Q214") ~ "Q214",
      str_length(cid4) > 4 & str_detect(cid4, "Q220") ~ "Q220",
      str_length(cid4) > 4 & str_detect(cid4, "Q224") ~ "Q224",
      str_length(cid4) > 4 & str_detect(cid4, "Q230") ~ "Q230",
      str_length(cid4) > 4 & str_detect(cid4, "Q240") ~ "Q240",
      str_length(cid4) > 4 & str_detect(cid4, "Q242") ~ "Q242",
      str_length(cid4) > 4 & str_detect(cid4, "Q243") ~ "Q243",
      str_length(cid4) > 4 & str_detect(cid4, "Q244") ~ "Q244",
      str_length(cid4) > 4 & str_detect(cid4, "Q245") ~ "Q245",
      str_length(cid4) > 4 & str_detect(cid4, "Q251") ~ "Q251",
      str_length(cid4) > 4 & str_detect(cid4, "Q255") ~ "Q255",
      str_length(cid4) > 4 & str_detect(cid4, "Q260") ~ "Q260",
      str_length(cid4) > 4 & str_detect(cid4, "Q262") ~ "Q262",
      str_length(cid4) > 4 & str_detect(cid4, "Q265") ~ "Q265",
      str_length(cid4) > 4 & str_detect(cid4, "Q266") ~ "Q266",
      str_length(cid4) > 4 & str_detect(cid4, "Q300") ~ "Q300",
      str_length(cid4) > 4 & str_detect(cid4, "Q301") ~ "Q301",
      str_length(cid4) > 4 & str_detect(cid4, "Q302") ~ "Q302",
      str_length(cid4) > 4 & str_detect(cid4, "Q313") ~ "Q313",
      str_length(cid4) > 4 & str_detect(cid4, "Q322") ~ "Q322",
      str_length(cid4) > 4 & str_detect(cid4, "Q323") ~ "Q323",
      str_length(cid4) > 4 & str_detect(cid4, "Q330") ~ "Q330",
      str_length(cid4) > 4 & str_detect(cid4, "Q332") ~ "Q332",
      str_length(cid4) > 4 & str_detect(cid4, "Q333") ~ "Q333",
      str_length(cid4) > 4 & str_detect(cid4, "Q334") ~ "Q334",
      str_length(cid4) > 4 & str_detect(cid4, "Q335") ~ "Q335",
      str_length(cid4) > 4 & str_detect(cid4, "Q336") ~ "Q336",
      str_length(cid4) > 4 & str_detect(cid4, "Q340") ~ "Q340",
      str_length(cid4) > 4 & str_detect(cid4, "Q790") ~ "Q790",
      str_length(cid4) > 4 & str_detect(cid4, "Q35X") ~ "Q35X",
      str_length(cid4) > 4 & str_detect(cid4, "Q042") ~ "Q042",
      str_length(cid4) > 4 & str_detect(cid4, "Q37X") ~ "Q37X",
      str_length(cid4) > 4 & str_detect(cid4, "Q042") ~ "Q042",
      str_length(cid4) > 4 & str_detect(cid4, "Q383") ~ "Q383",
      str_length(cid4) > 4 & str_detect(cid4, "Q384") ~ "Q383",
      str_length(cid4) > 4 & str_detect(cid4, "Q387") ~ "Q387",
      str_length(cid4) > 4 & str_detect(cid4, "Q390") ~ "Q390",
      str_length(cid4) > 4 & str_detect(cid4, "Q391") ~ "Q391",
      str_length(cid4) > 4 & str_detect(cid4, "Q392") ~ "Q392",
      str_length(cid4) > 4 & str_detect(cid4, "Q393") ~ "Q393",
      str_length(cid4) > 4 & str_detect(cid4, "Q396") ~ "Q396",
      str_length(cid4) > 4 & str_detect(cid4, "Q403") ~ "Q403",
      str_length(cid4) > 4 & str_detect(cid4, "Q410") ~ "Q410",
      str_length(cid4) > 4 & str_detect(cid4, "Q423") ~ "Q423",
      str_length(cid4) > 4 & str_detect(cid4, "Q428") ~ "Q428",
      str_length(cid4) > 4 & str_detect(cid4, "Q431") ~ "Q431",
      str_length(cid4) > 4 & str_detect(cid4, "Q433") ~ "Q433",
      str_length(cid4) > 4 & str_detect(cid4, "Q434") ~ "Q434",
      str_length(cid4) > 4 & str_detect(cid4, "Q435") ~ "Q435",
      str_length(cid4) > 4 & str_detect(cid4, "Q436") ~ "Q436",
      str_length(cid4) > 4 & str_detect(cid4, "Q440") ~ "Q440",
      str_length(cid4) > 4 & str_detect(cid4, "Q442") ~ "Q442",
      str_length(cid4) > 4 & str_detect(cid4, "Q446") ~ "Q446",
      str_length(cid4) > 4 & str_detect(cid4, "Q451") ~ "Q451",
      str_length(cid4) > 4 & str_detect(cid4, "Q422") ~ "Q422",
      str_length(cid4) > 4 & str_detect(cid4, "Q500") ~ "Q500",
      str_length(cid4) > 4 & str_detect(cid4, "Q501") ~ "Q501",
      str_length(cid4) > 4 & str_detect(cid4, "Q502") ~ "Q502",
      str_length(cid4) > 4 & str_detect(cid4, "Q505") ~ "Q505",
      str_length(cid4) > 4 & str_detect(cid4, "Q510") ~ "Q510",
      str_length(cid4) > 4 & str_detect(cid4, "Q513") ~ "Q513",
      str_length(cid4) > 4 & str_detect(cid4, "Q516") ~ "Q516",
      str_length(cid4) > 4 & str_detect(cid4, "Q517") ~ "Q517",
      str_length(cid4) > 4 & str_detect(cid4, "Q520") ~ "Q520",
      str_length(cid4) > 4 & str_detect(cid4, "Q521") ~ "Q521",
      str_length(cid4) > 4 & str_detect(cid4, "Q522") ~ "Q522",
      str_length(cid4) > 4 & str_detect(cid4, "Q526") ~ "Q526",
      str_length(cid4) > 4 & str_detect(cid4, "Q527") ~ "Q527",
      str_length(cid4) > 4 & str_detect(cid4, "Q549") ~ "Q549",
      str_length(cid4) > 4 & str_detect(cid4, "Q550") ~ "Q550",
      str_length(cid4) > 4 & str_detect(cid4, "Q553") ~ "Q553",
      str_length(cid4) > 4 & str_detect(cid4, "Q555") ~ "Q555",
      str_length(cid4) > 4 & str_detect(cid4, "Q560") ~ "Q560",
      str_length(cid4) > 4 & str_detect(cid4, "Q600") ~ "Q600",
      str_length(cid4) > 4 & str_detect(cid4, "Q601") ~ "Q601",
      str_length(cid4) > 4 & str_detect(cid4, "Q603") ~ "Q603",
      str_length(cid4) > 4 & str_detect(cid4, "Q604") ~ "Q604",
      str_length(cid4) > 4 & str_detect(cid4, "Q613") ~ "Q613",
      str_length(cid4) > 4 & str_detect(cid4, "Q614") ~ "Q614",
      str_length(cid4) > 4 & str_detect(cid4, "Q620") ~ "Q620",
      str_length(cid4) > 4 & str_detect(cid4, "Q624") ~ "Q624",
      str_length(cid4) > 4 & str_detect(cid4, "Q625") ~ "Q625",
      str_length(cid4) > 4 & str_detect(cid4, "Q630") ~ "Q630",
      str_length(cid4) > 4 & str_detect(cid4, "Q631") ~ "Q631",
      str_length(cid4) > 4 & str_detect(cid4, "Q632") ~ "Q632",
      str_length(cid4) > 4 & str_detect(cid4, "Q640") ~ "Q640",
      str_length(cid4) > 4 & str_detect(cid4, "Q641") ~ "Q642",
      str_length(cid4) > 4 & str_detect(cid4, "Q644") ~ "Q645",
      str_length(cid4) > 4 & str_detect(cid4, "Q646") ~ "Q646",
      str_length(cid4) > 4 & str_detect(cid4, "Q652") ~ "Q652",
      str_length(cid4) > 4 & str_detect(cid4, "Q66X") ~ "Q66X",
      str_length(cid4) > 4 & str_detect(cid4, "Q69X") ~ "Q69X",
      str_length(cid4) > 4 & str_detect(cid4, "Q709") ~ "Q709",
      str_length(cid4) > 4 & str_detect(cid4, "Q716") ~ "Q716",
      str_length(cid4) > 4 & str_detect(cid4, "Q718") ~ "Q718",
      str_length(cid4) > 4 & str_detect(cid4, "Q728") ~ "Q728",
      str_length(cid4) > 4 & str_detect(cid4, "Q743") ~ "Q743",
      str_length(cid4) > 4 & str_detect(cid4, "Q750") ~ "Q750",
      str_length(cid4) > 4 & str_detect(cid4, "Q751") ~ "Q751",
      str_length(cid4) > 4 & str_detect(cid4, "Q770") ~ "Q770",
      str_length(cid4) > 4 & str_detect(cid4, "Q771") ~ "Q771",
      str_length(cid4) > 4 & str_detect(cid4, "Q772") ~ "Q772",
      str_length(cid4) > 4 & str_detect(cid4, "Q773") ~ "Q773",
      str_length(cid4) > 4 & str_detect(cid4, "Q775") ~ "Q775",
      str_length(cid4) > 4 & str_detect(cid4, "Q776") ~ "Q776",
      str_length(cid4) > 4 & str_detect(cid4, "Q777") ~ "Q777",
      str_length(cid4) > 4 & str_detect(cid4, "Q780") ~ "Q780",
      str_length(cid4) > 4 & str_detect(cid4, "Q781") ~ "Q781",
      str_length(cid4) > 4 & str_detect(cid4, "Q782") ~ "Q782",
      str_length(cid4) > 4 & str_detect(cid4, "Q783") ~ "Q783",
      str_length(cid4) > 4 & str_detect(cid4, "Q784") ~ "Q784",
      str_length(cid4) > 4 & str_detect(cid4, "Q785") ~ "Q785",
      str_length(cid4) > 4 & str_detect(cid4, "Q786") ~ "Q786",
      str_length(cid4) > 4 & str_detect(cid4, "Q792") ~ "Q792",
      str_length(cid4) > 4 & str_detect(cid4, "Q793") ~ "Q793",
      str_length(cid4) > 4 & str_detect(cid4, "Q794") ~ "Q794",
      str_length(cid4) > 4 & str_detect(cid4, "Q809") ~ "Q809",
      str_length(cid4) > 4 & str_detect(cid4, "Q819") ~ "Q819",
      str_length(cid4) > 4 & str_detect(cid4, "Q820") ~ "Q820",
      str_length(cid4) > 4 & str_detect(cid4, "Q821") ~ "Q821",
      str_length(cid4) > 4 & str_detect(cid4, "Q822") ~ "Q822",
      str_length(cid4) > 4 & str_detect(cid4, "Q823") ~ "Q823",
      str_length(cid4) > 4 & str_detect(cid4, "Q824") ~ "Q824",
      str_length(cid4) > 4 & str_detect(cid4, "Q860") ~ "Q860",
      str_length(cid4) > 4 & str_detect(cid4, "Q861") ~ "Q861",
      str_length(cid4) > 4 & str_detect(cid4, "Q862") ~ "Q862",
      TRUE ~ cid4
    ),
    # cid5
    cf5 = case_when(
      str_length(cid5) > 4 & str_detect(cid5, "Q000") ~ "Q000",
      str_length(cid5) > 4 & str_detect(cid5, "Q01X") ~ "Q01X",
      str_length(cid5) > 4 & str_detect(cid5, "Q02X") ~ "Q02X",
      str_length(cid5) > 4 & str_detect(cid5, "Q039") ~ "Q039",
      str_length(cid5) > 4 & str_detect(cid5, "Q040") ~ "Q040",
      str_length(cid5) > 4 & str_detect(cid5, "Q042") ~ "Q042",
      str_length(cid5) > 4 & str_detect(cid5, "Q045") ~ "Q045",
      str_length(cid5) > 4 & str_detect(cid5, "Q046") ~ "Q046",
      str_length(cid5) > 4 & str_detect(cid5, "Q05X") ~ "Q05X",
      str_length(cid5) > 4 & str_detect(cid5, "Q01X") ~ "Q01X",
      str_length(cid5) > 4 & str_detect(cid5, "Q060") ~ "Q060",
      str_length(cid5) > 4 & str_detect(cid5, "Q062") ~ "Q062",
      str_length(cid5) > 4 & str_detect(cid5, "Q064") ~ "Q064",
      str_length(cid5) > 4 & str_detect(cid5, "Q104") ~ "Q104",
      str_length(cid5) > 4 & str_detect(cid5, "Q110") ~ "Q110",
      str_length(cid5) > 4 & str_detect(cid5, "Q111") ~ "Q111",
      str_length(cid5) > 4 & str_detect(cid5, "Q112") ~ "Q112",
      str_length(cid5) > 4 & str_detect(cid5, "Q113") ~ "Q120",
      str_length(cid5) > 4 & str_detect(cid5, "Q132") ~ "Q132",
      str_length(cid5) > 4 & str_detect(cid5, "Q150") ~ "Q150",
      str_length(cid5) > 4 & str_detect(cid5, "Q160") ~ "Q160",
      str_length(cid5) > 4 & str_detect(cid5, "Q200") ~ "Q200",
      str_length(cid5) > 4 & str_detect(cid5, "Q201") ~ "Q201",
      str_length(cid5) > 4 & str_detect(cid5, "Q202") ~ "Q202",
      str_length(cid5) > 4 & str_detect(cid5, "Q203") ~ "Q203",
      str_length(cid5) > 4 & str_detect(cid5, "Q204") ~ "Q204",
      str_length(cid5) > 4 & str_detect(cid5, "Q205") ~ "Q205",
      str_length(cid5) > 4 & str_detect(cid5, "Q206") ~ "Q206",
      str_length(cid5) > 4 & str_detect(cid5, "Q210") ~ "Q210",
      str_length(cid5) > 4 & str_detect(cid5, "Q211") ~ "Q211",
      str_length(cid5) > 4 & str_detect(cid5, "Q212") ~ "Q212",
      str_length(cid5) > 4 & str_detect(cid5, "Q213") ~ "Q213",
      str_length(cid5) > 4 & str_detect(cid5, "Q214") ~ "Q214",
      str_length(cid5) > 4 & str_detect(cid5, "Q220") ~ "Q220",
      str_length(cid5) > 4 & str_detect(cid5, "Q224") ~ "Q224",
      str_length(cid5) > 4 & str_detect(cid5, "Q230") ~ "Q230",
      str_length(cid5) > 4 & str_detect(cid5, "Q240") ~ "Q240",
      str_length(cid5) > 4 & str_detect(cid5, "Q242") ~ "Q242",
      str_length(cid5) > 4 & str_detect(cid5, "Q243") ~ "Q243",
      str_length(cid5) > 4 & str_detect(cid5, "Q244") ~ "Q244",
      str_length(cid5) > 4 & str_detect(cid5, "Q245") ~ "Q245",
      str_length(cid5) > 4 & str_detect(cid5, "Q251") ~ "Q251",
      str_length(cid5) > 4 & str_detect(cid5, "Q255") ~ "Q255",
      str_length(cid5) > 4 & str_detect(cid5, "Q260") ~ "Q260",
      str_length(cid5) > 4 & str_detect(cid5, "Q262") ~ "Q262",
      str_length(cid5) > 4 & str_detect(cid5, "Q265") ~ "Q265",
      str_length(cid5) > 4 & str_detect(cid5, "Q266") ~ "Q266",
      str_length(cid5) > 4 & str_detect(cid5, "Q300") ~ "Q300",
      str_length(cid5) > 4 & str_detect(cid5, "Q301") ~ "Q301",
      str_length(cid5) > 4 & str_detect(cid5, "Q302") ~ "Q302",
      str_length(cid5) > 4 & str_detect(cid5, "Q313") ~ "Q313",
      str_length(cid5) > 4 & str_detect(cid5, "Q322") ~ "Q322",
      str_length(cid5) > 4 & str_detect(cid5, "Q323") ~ "Q323",
      str_length(cid5) > 4 & str_detect(cid5, "Q330") ~ "Q330",
      str_length(cid5) > 4 & str_detect(cid5, "Q332") ~ "Q332",
      str_length(cid5) > 4 & str_detect(cid5, "Q333") ~ "Q333",
      str_length(cid5) > 4 & str_detect(cid5, "Q334") ~ "Q334",
      str_length(cid5) > 4 & str_detect(cid5, "Q335") ~ "Q335",
      str_length(cid5) > 4 & str_detect(cid5, "Q336") ~ "Q336",
      str_length(cid5) > 4 & str_detect(cid5, "Q340") ~ "Q340",
      str_length(cid5) > 4 & str_detect(cid5, "Q790") ~ "Q790",
      str_length(cid5) > 4 & str_detect(cid5, "Q35X") ~ "Q35X",
      str_length(cid5) > 4 & str_detect(cid5, "Q042") ~ "Q042",
      str_length(cid5) > 4 & str_detect(cid5, "Q37X") ~ "Q37X",
      str_length(cid5) > 4 & str_detect(cid5, "Q042") ~ "Q042",
      str_length(cid5) > 4 & str_detect(cid5, "Q383") ~ "Q383",
      str_length(cid5) > 4 & str_detect(cid5, "Q384") ~ "Q383",
      str_length(cid5) > 4 & str_detect(cid5, "Q387") ~ "Q387",
      str_length(cid5) > 4 & str_detect(cid5, "Q390") ~ "Q390",
      str_length(cid5) > 4 & str_detect(cid5, "Q391") ~ "Q391",
      str_length(cid5) > 4 & str_detect(cid5, "Q392") ~ "Q392",
      str_length(cid5) > 4 & str_detect(cid5, "Q393") ~ "Q393",
      str_length(cid5) > 4 & str_detect(cid5, "Q396") ~ "Q396",
      str_length(cid5) > 4 & str_detect(cid5, "Q403") ~ "Q403",
      str_length(cid5) > 4 & str_detect(cid5, "Q410") ~ "Q410",
      str_length(cid5) > 4 & str_detect(cid5, "Q423") ~ "Q423",
      str_length(cid5) > 4 & str_detect(cid5, "Q428") ~ "Q428",
      str_length(cid5) > 4 & str_detect(cid5, "Q431") ~ "Q431",
      str_length(cid5) > 4 & str_detect(cid5, "Q433") ~ "Q433",
      str_length(cid5) > 4 & str_detect(cid5, "Q434") ~ "Q434",
      str_length(cid5) > 4 & str_detect(cid5, "Q435") ~ "Q435",
      str_length(cid5) > 4 & str_detect(cid5, "Q436") ~ "Q436",
      str_length(cid5) > 4 & str_detect(cid5, "Q440") ~ "Q440",
      str_length(cid5) > 4 & str_detect(cid5, "Q442") ~ "Q442",
      str_length(cid5) > 4 & str_detect(cid5, "Q446") ~ "Q446",
      str_length(cid5) > 4 & str_detect(cid5, "Q451") ~ "Q451",
      str_length(cid5) > 4 & str_detect(cid5, "Q422") ~ "Q422",
      str_length(cid5) > 4 & str_detect(cid5, "Q500") ~ "Q500",
      str_length(cid5) > 4 & str_detect(cid5, "Q501") ~ "Q501",
      str_length(cid5) > 4 & str_detect(cid5, "Q502") ~ "Q502",
      str_length(cid5) > 4 & str_detect(cid5, "Q505") ~ "Q505",
      str_length(cid5) > 4 & str_detect(cid5, "Q510") ~ "Q510",
      str_length(cid5) > 4 & str_detect(cid5, "Q513") ~ "Q513",
      str_length(cid5) > 4 & str_detect(cid5, "Q516") ~ "Q516",
      str_length(cid5) > 4 & str_detect(cid5, "Q517") ~ "Q517",
      str_length(cid5) > 4 & str_detect(cid5, "Q520") ~ "Q520",
      str_length(cid5) > 4 & str_detect(cid5, "Q521") ~ "Q521",
      str_length(cid5) > 4 & str_detect(cid5, "Q522") ~ "Q522",
      str_length(cid5) > 4 & str_detect(cid5, "Q526") ~ "Q526",
      str_length(cid5) > 4 & str_detect(cid5, "Q527") ~ "Q527",
      str_length(cid5) > 4 & str_detect(cid5, "Q549") ~ "Q549",
      str_length(cid5) > 4 & str_detect(cid5, "Q550") ~ "Q550",
      str_length(cid5) > 4 & str_detect(cid5, "Q553") ~ "Q553",
      str_length(cid5) > 4 & str_detect(cid5, "Q555") ~ "Q555",
      str_length(cid5) > 4 & str_detect(cid5, "Q560") ~ "Q560",
      str_length(cid5) > 4 & str_detect(cid5, "Q600") ~ "Q600",
      str_length(cid5) > 4 & str_detect(cid5, "Q601") ~ "Q601",
      str_length(cid5) > 4 & str_detect(cid5, "Q603") ~ "Q603",
      str_length(cid5) > 4 & str_detect(cid5, "Q604") ~ "Q604",
      str_length(cid5) > 4 & str_detect(cid5, "Q613") ~ "Q613",
      str_length(cid5) > 4 & str_detect(cid5, "Q614") ~ "Q614",
      str_length(cid5) > 4 & str_detect(cid5, "Q620") ~ "Q620",
      str_length(cid5) > 4 & str_detect(cid5, "Q624") ~ "Q624",
      str_length(cid5) > 4 & str_detect(cid5, "Q625") ~ "Q625",
      str_length(cid5) > 4 & str_detect(cid5, "Q630") ~ "Q630",
      str_length(cid5) > 4 & str_detect(cid5, "Q631") ~ "Q631",
      str_length(cid5) > 4 & str_detect(cid5, "Q632") ~ "Q632",
      str_length(cid5) > 4 & str_detect(cid5, "Q640") ~ "Q640",
      str_length(cid5) > 4 & str_detect(cid5, "Q641") ~ "Q642",
      str_length(cid5) > 4 & str_detect(cid5, "Q644") ~ "Q645",
      str_length(cid5) > 4 & str_detect(cid5, "Q646") ~ "Q646",
      str_length(cid5) > 4 & str_detect(cid5, "Q652") ~ "Q652",
      str_length(cid5) > 4 & str_detect(cid5, "Q66X") ~ "Q66X",
      str_length(cid5) > 4 & str_detect(cid5, "Q69X") ~ "Q69X",
      str_length(cid5) > 4 & str_detect(cid5, "Q709") ~ "Q709",
      str_length(cid5) > 4 & str_detect(cid5, "Q716") ~ "Q716",
      str_length(cid5) > 4 & str_detect(cid5, "Q718") ~ "Q718",
      str_length(cid5) > 4 & str_detect(cid5, "Q728") ~ "Q728",
      str_length(cid5) > 4 & str_detect(cid5, "Q743") ~ "Q743",
      str_length(cid5) > 4 & str_detect(cid5, "Q750") ~ "Q750",
      str_length(cid5) > 4 & str_detect(cid5, "Q751") ~ "Q751",
      str_length(cid5) > 4 & str_detect(cid5, "Q770") ~ "Q770",
      str_length(cid5) > 4 & str_detect(cid5, "Q771") ~ "Q771",
      str_length(cid5) > 4 & str_detect(cid5, "Q772") ~ "Q772",
      str_length(cid5) > 4 & str_detect(cid5, "Q773") ~ "Q773",
      str_length(cid5) > 4 & str_detect(cid5, "Q775") ~ "Q775",
      str_length(cid5) > 4 & str_detect(cid5, "Q776") ~ "Q776",
      str_length(cid5) > 4 & str_detect(cid5, "Q777") ~ "Q777",
      str_length(cid5) > 4 & str_detect(cid5, "Q780") ~ "Q780",
      str_length(cid5) > 4 & str_detect(cid5, "Q781") ~ "Q781",
      str_length(cid5) > 4 & str_detect(cid5, "Q782") ~ "Q782",
      str_length(cid5) > 4 & str_detect(cid5, "Q783") ~ "Q783",
      str_length(cid5) > 4 & str_detect(cid5, "Q784") ~ "Q784",
      str_length(cid5) > 4 & str_detect(cid5, "Q785") ~ "Q785",
      str_length(cid5) > 4 & str_detect(cid5, "Q786") ~ "Q786",
      str_length(cid5) > 4 & str_detect(cid5, "Q792") ~ "Q792",
      str_length(cid5) > 4 & str_detect(cid5, "Q793") ~ "Q793",
      str_length(cid5) > 4 & str_detect(cid5, "Q794") ~ "Q794",
      str_length(cid5) > 4 & str_detect(cid5, "Q809") ~ "Q809",
      str_length(cid5) > 4 & str_detect(cid5, "Q819") ~ "Q819",
      str_length(cid5) > 4 & str_detect(cid5, "Q820") ~ "Q820",
      str_length(cid5) > 4 & str_detect(cid5, "Q821") ~ "Q821",
      str_length(cid5) > 4 & str_detect(cid5, "Q822") ~ "Q822",
      str_length(cid5) > 4 & str_detect(cid5, "Q823") ~ "Q823",
      str_length(cid5) > 4 & str_detect(cid5, "Q824") ~ "Q824",
      str_length(cid5) > 4 & str_detect(cid5, "Q860") ~ "Q860",
      str_length(cid5) > 4 & str_detect(cid5, "Q861") ~ "Q861",
      str_length(cid5) > 4 & str_detect(cid5, "Q862") ~ "Q862",
      TRUE ~ cid5
    ),
    # cid6
    cf6 = case_when(
      str_length(cid6) > 4 & str_detect(cid6, "Q000") ~ "Q000",
      str_length(cid6) > 4 & str_detect(cid6, "Q01X") ~ "Q01X",
      str_length(cid6) > 4 & str_detect(cid6, "Q02X") ~ "Q02X",
      str_length(cid6) > 4 & str_detect(cid6, "Q039") ~ "Q039",
      str_length(cid6) > 4 & str_detect(cid6, "Q040") ~ "Q040",
      str_length(cid6) > 4 & str_detect(cid6, "Q042") ~ "Q042",
      str_length(cid6) > 4 & str_detect(cid6, "Q045") ~ "Q045",
      str_length(cid6) > 4 & str_detect(cid6, "Q046") ~ "Q046",
      str_length(cid6) > 4 & str_detect(cid6, "Q05X") ~ "Q05X",
      str_length(cid6) > 4 & str_detect(cid6, "Q01X") ~ "Q01X",
      str_length(cid6) > 4 & str_detect(cid6, "Q060") ~ "Q060",
      str_length(cid6) > 4 & str_detect(cid6, "Q062") ~ "Q062",
      str_length(cid6) > 4 & str_detect(cid6, "Q064") ~ "Q064",
      str_length(cid6) > 4 & str_detect(cid6, "Q104") ~ "Q104",
      str_length(cid6) > 4 & str_detect(cid6, "Q110") ~ "Q110",
      str_length(cid6) > 4 & str_detect(cid6, "Q111") ~ "Q111",
      str_length(cid6) > 4 & str_detect(cid6, "Q112") ~ "Q112",
      str_length(cid6) > 4 & str_detect(cid6, "Q113") ~ "Q120",
      str_length(cid6) > 4 & str_detect(cid6, "Q132") ~ "Q132",
      str_length(cid6) > 4 & str_detect(cid6, "Q150") ~ "Q150",
      str_length(cid6) > 4 & str_detect(cid6, "Q160") ~ "Q160",
      str_length(cid6) > 4 & str_detect(cid6, "Q200") ~ "Q200",
      str_length(cid6) > 4 & str_detect(cid6, "Q201") ~ "Q201",
      str_length(cid6) > 4 & str_detect(cid6, "Q202") ~ "Q202",
      str_length(cid6) > 4 & str_detect(cid6, "Q203") ~ "Q203",
      str_length(cid6) > 4 & str_detect(cid6, "Q204") ~ "Q204",
      str_length(cid6) > 4 & str_detect(cid6, "Q205") ~ "Q205",
      str_length(cid6) > 4 & str_detect(cid6, "Q206") ~ "Q206",
      str_length(cid6) > 4 & str_detect(cid6, "Q210") ~ "Q210",
      str_length(cid6) > 4 & str_detect(cid6, "Q211") ~ "Q211",
      str_length(cid6) > 4 & str_detect(cid6, "Q212") ~ "Q212",
      str_length(cid6) > 4 & str_detect(cid6, "Q213") ~ "Q213",
      str_length(cid6) > 4 & str_detect(cid6, "Q214") ~ "Q214",
      str_length(cid6) > 4 & str_detect(cid6, "Q220") ~ "Q220",
      str_length(cid6) > 4 & str_detect(cid6, "Q224") ~ "Q224",
      str_length(cid6) > 4 & str_detect(cid6, "Q230") ~ "Q230",
      str_length(cid6) > 4 & str_detect(cid6, "Q240") ~ "Q240",
      str_length(cid6) > 4 & str_detect(cid6, "Q242") ~ "Q242",
      str_length(cid6) > 4 & str_detect(cid6, "Q243") ~ "Q243",
      str_length(cid6) > 4 & str_detect(cid6, "Q244") ~ "Q244",
      str_length(cid6) > 4 & str_detect(cid6, "Q245") ~ "Q245",
      str_length(cid6) > 4 & str_detect(cid6, "Q251") ~ "Q251",
      str_length(cid6) > 4 & str_detect(cid6, "Q255") ~ "Q255",
      str_length(cid6) > 4 & str_detect(cid6, "Q260") ~ "Q260",
      str_length(cid6) > 4 & str_detect(cid6, "Q262") ~ "Q262",
      str_length(cid6) > 4 & str_detect(cid6, "Q265") ~ "Q265",
      str_length(cid6) > 4 & str_detect(cid6, "Q266") ~ "Q266",
      str_length(cid6) > 4 & str_detect(cid6, "Q300") ~ "Q300",
      str_length(cid6) > 4 & str_detect(cid6, "Q301") ~ "Q301",
      str_length(cid6) > 4 & str_detect(cid6, "Q302") ~ "Q302",
      str_length(cid6) > 4 & str_detect(cid6, "Q313") ~ "Q313",
      str_length(cid6) > 4 & str_detect(cid6, "Q322") ~ "Q322",
      str_length(cid6) > 4 & str_detect(cid6, "Q323") ~ "Q323",
      str_length(cid6) > 4 & str_detect(cid6, "Q330") ~ "Q330",
      str_length(cid6) > 4 & str_detect(cid6, "Q332") ~ "Q332",
      str_length(cid6) > 4 & str_detect(cid6, "Q333") ~ "Q333",
      str_length(cid6) > 4 & str_detect(cid6, "Q334") ~ "Q334",
      str_length(cid6) > 4 & str_detect(cid6, "Q335") ~ "Q335",
      str_length(cid6) > 4 & str_detect(cid6, "Q336") ~ "Q336",
      str_length(cid6) > 4 & str_detect(cid6, "Q340") ~ "Q340",
      str_length(cid6) > 4 & str_detect(cid6, "Q790") ~ "Q790",
      str_length(cid6) > 4 & str_detect(cid6, "Q35X") ~ "Q35X",
      str_length(cid6) > 4 & str_detect(cid6, "Q042") ~ "Q042",
      str_length(cid6) > 4 & str_detect(cid6, "Q37X") ~ "Q37X",
      str_length(cid6) > 4 & str_detect(cid6, "Q042") ~ "Q042",
      str_length(cid6) > 4 & str_detect(cid6, "Q383") ~ "Q383",
      str_length(cid6) > 4 & str_detect(cid6, "Q384") ~ "Q383",
      str_length(cid6) > 4 & str_detect(cid6, "Q387") ~ "Q387",
      str_length(cid6) > 4 & str_detect(cid6, "Q390") ~ "Q390",
      str_length(cid6) > 4 & str_detect(cid6, "Q391") ~ "Q391",
      str_length(cid6) > 4 & str_detect(cid6, "Q392") ~ "Q392",
      str_length(cid6) > 4 & str_detect(cid6, "Q393") ~ "Q393",
      str_length(cid6) > 4 & str_detect(cid6, "Q396") ~ "Q396",
      str_length(cid6) > 4 & str_detect(cid6, "Q403") ~ "Q403",
      str_length(cid6) > 4 & str_detect(cid6, "Q410") ~ "Q410",
      str_length(cid6) > 4 & str_detect(cid6, "Q423") ~ "Q423",
      str_length(cid6) > 4 & str_detect(cid6, "Q428") ~ "Q428",
      str_length(cid6) > 4 & str_detect(cid6, "Q431") ~ "Q431",
      str_length(cid6) > 4 & str_detect(cid6, "Q433") ~ "Q433",
      str_length(cid6) > 4 & str_detect(cid6, "Q434") ~ "Q434",
      str_length(cid6) > 4 & str_detect(cid6, "Q435") ~ "Q435",
      str_length(cid6) > 4 & str_detect(cid6, "Q436") ~ "Q436",
      str_length(cid6) > 4 & str_detect(cid6, "Q440") ~ "Q440",
      str_length(cid6) > 4 & str_detect(cid6, "Q442") ~ "Q442",
      str_length(cid6) > 4 & str_detect(cid6, "Q446") ~ "Q446",
      str_length(cid6) > 4 & str_detect(cid6, "Q451") ~ "Q451",
      str_length(cid6) > 4 & str_detect(cid6, "Q422") ~ "Q422",
      str_length(cid6) > 4 & str_detect(cid6, "Q500") ~ "Q500",
      str_length(cid6) > 4 & str_detect(cid6, "Q501") ~ "Q501",
      str_length(cid6) > 4 & str_detect(cid6, "Q502") ~ "Q502",
      str_length(cid6) > 4 & str_detect(cid6, "Q505") ~ "Q505",
      str_length(cid6) > 4 & str_detect(cid6, "Q510") ~ "Q510",
      str_length(cid6) > 4 & str_detect(cid6, "Q513") ~ "Q513",
      str_length(cid6) > 4 & str_detect(cid6, "Q516") ~ "Q516",
      str_length(cid6) > 4 & str_detect(cid6, "Q517") ~ "Q517",
      str_length(cid6) > 4 & str_detect(cid6, "Q520") ~ "Q520",
      str_length(cid6) > 4 & str_detect(cid6, "Q521") ~ "Q521",
      str_length(cid6) > 4 & str_detect(cid6, "Q522") ~ "Q522",
      str_length(cid6) > 4 & str_detect(cid6, "Q526") ~ "Q526",
      str_length(cid6) > 4 & str_detect(cid6, "Q527") ~ "Q527",
      str_length(cid6) > 4 & str_detect(cid6, "Q549") ~ "Q549",
      str_length(cid6) > 4 & str_detect(cid6, "Q550") ~ "Q550",
      str_length(cid6) > 4 & str_detect(cid6, "Q553") ~ "Q553",
      str_length(cid6) > 4 & str_detect(cid6, "Q555") ~ "Q555",
      str_length(cid6) > 4 & str_detect(cid6, "Q560") ~ "Q560",
      str_length(cid6) > 4 & str_detect(cid6, "Q600") ~ "Q600",
      str_length(cid6) > 4 & str_detect(cid6, "Q601") ~ "Q601",
      str_length(cid6) > 4 & str_detect(cid6, "Q603") ~ "Q603",
      str_length(cid6) > 4 & str_detect(cid6, "Q604") ~ "Q604",
      str_length(cid6) > 4 & str_detect(cid6, "Q613") ~ "Q613",
      str_length(cid6) > 4 & str_detect(cid6, "Q614") ~ "Q614",
      str_length(cid6) > 4 & str_detect(cid6, "Q620") ~ "Q620",
      str_length(cid6) > 4 & str_detect(cid6, "Q624") ~ "Q624",
      str_length(cid6) > 4 & str_detect(cid6, "Q625") ~ "Q625",
      str_length(cid6) > 4 & str_detect(cid6, "Q630") ~ "Q630",
      str_length(cid6) > 4 & str_detect(cid6, "Q631") ~ "Q631",
      str_length(cid6) > 4 & str_detect(cid6, "Q632") ~ "Q632",
      str_length(cid6) > 4 & str_detect(cid6, "Q640") ~ "Q640",
      str_length(cid6) > 4 & str_detect(cid6, "Q641") ~ "Q642",
      str_length(cid6) > 4 & str_detect(cid6, "Q644") ~ "Q645",
      str_length(cid6) > 4 & str_detect(cid6, "Q646") ~ "Q646",
      str_length(cid6) > 4 & str_detect(cid6, "Q652") ~ "Q652",
      str_length(cid6) > 4 & str_detect(cid6, "Q66X") ~ "Q66X",
      str_length(cid6) > 4 & str_detect(cid6, "Q69X") ~ "Q69X",
      str_length(cid6) > 4 & str_detect(cid6, "Q709") ~ "Q709",
      str_length(cid6) > 4 & str_detect(cid6, "Q716") ~ "Q716",
      str_length(cid6) > 4 & str_detect(cid6, "Q718") ~ "Q718",
      str_length(cid6) > 4 & str_detect(cid6, "Q728") ~ "Q728",
      str_length(cid6) > 4 & str_detect(cid6, "Q743") ~ "Q743",
      str_length(cid6) > 4 & str_detect(cid6, "Q750") ~ "Q750",
      str_length(cid6) > 4 & str_detect(cid6, "Q751") ~ "Q751",
      str_length(cid6) > 4 & str_detect(cid6, "Q770") ~ "Q770",
      str_length(cid6) > 4 & str_detect(cid6, "Q771") ~ "Q771",
      str_length(cid6) > 4 & str_detect(cid6, "Q772") ~ "Q772",
      str_length(cid6) > 4 & str_detect(cid6, "Q773") ~ "Q773",
      str_length(cid6) > 4 & str_detect(cid6, "Q775") ~ "Q775",
      str_length(cid6) > 4 & str_detect(cid6, "Q776") ~ "Q776",
      str_length(cid6) > 4 & str_detect(cid6, "Q777") ~ "Q777",
      str_length(cid6) > 4 & str_detect(cid6, "Q780") ~ "Q780",
      str_length(cid6) > 4 & str_detect(cid6, "Q781") ~ "Q781",
      str_length(cid6) > 4 & str_detect(cid6, "Q782") ~ "Q782",
      str_length(cid6) > 4 & str_detect(cid6, "Q783") ~ "Q783",
      str_length(cid6) > 4 & str_detect(cid6, "Q784") ~ "Q784",
      str_length(cid6) > 4 & str_detect(cid6, "Q785") ~ "Q785",
      str_length(cid6) > 4 & str_detect(cid6, "Q786") ~ "Q786",
      str_length(cid6) > 4 & str_detect(cid6, "Q792") ~ "Q792",
      str_length(cid6) > 4 & str_detect(cid6, "Q793") ~ "Q793",
      str_length(cid6) > 4 & str_detect(cid6, "Q794") ~ "Q794",
      str_length(cid6) > 4 & str_detect(cid6, "Q809") ~ "Q809",
      str_length(cid6) > 4 & str_detect(cid6, "Q819") ~ "Q819",
      str_length(cid6) > 4 & str_detect(cid6, "Q820") ~ "Q820",
      str_length(cid6) > 4 & str_detect(cid6, "Q821") ~ "Q821",
      str_length(cid6) > 4 & str_detect(cid6, "Q822") ~ "Q822",
      str_length(cid6) > 4 & str_detect(cid6, "Q823") ~ "Q823",
      str_length(cid6) > 4 & str_detect(cid6, "Q824") ~ "Q824",
      str_length(cid6) > 4 & str_detect(cid6, "Q860") ~ "Q860",
      str_length(cid6) > 4 & str_detect(cid6, "Q861") ~ "Q861",
      str_length(cid6) > 4 & str_detect(cid6, "Q862") ~ "Q862",
      TRUE ~ cid6
    ),
    # cid7
    cf7 = case_when(
      str_length(cid7) > 4 & str_detect(cid7, "Q000") ~ "Q000",
      str_length(cid7) > 4 & str_detect(cid7, "Q01X") ~ "Q01X",
      str_length(cid7) > 4 & str_detect(cid7, "Q02X") ~ "Q02X",
      str_length(cid7) > 4 & str_detect(cid7, "Q039") ~ "Q039",
      str_length(cid7) > 4 & str_detect(cid7, "Q040") ~ "Q040",
      str_length(cid7) > 4 & str_detect(cid7, "Q042") ~ "Q042",
      str_length(cid7) > 4 & str_detect(cid7, "Q045") ~ "Q045",
      str_length(cid7) > 4 & str_detect(cid7, "Q046") ~ "Q046",
      str_length(cid7) > 4 & str_detect(cid7, "Q05X") ~ "Q05X",
      str_length(cid7) > 4 & str_detect(cid7, "Q01X") ~ "Q01X",
      str_length(cid7) > 4 & str_detect(cid7, "Q060") ~ "Q060",
      str_length(cid7) > 4 & str_detect(cid7, "Q062") ~ "Q062",
      str_length(cid7) > 4 & str_detect(cid7, "Q064") ~ "Q064",
      str_length(cid7) > 4 & str_detect(cid7, "Q104") ~ "Q104",
      str_length(cid7) > 4 & str_detect(cid7, "Q110") ~ "Q110",
      str_length(cid7) > 4 & str_detect(cid7, "Q111") ~ "Q111",
      str_length(cid7) > 4 & str_detect(cid7, "Q112") ~ "Q112",
      str_length(cid7) > 4 & str_detect(cid7, "Q113") ~ "Q120",
      str_length(cid7) > 4 & str_detect(cid7, "Q132") ~ "Q132",
      str_length(cid7) > 4 & str_detect(cid7, "Q150") ~ "Q150",
      str_length(cid7) > 4 & str_detect(cid7, "Q160") ~ "Q160",
      str_length(cid7) > 4 & str_detect(cid7, "Q200") ~ "Q200",
      str_length(cid7) > 4 & str_detect(cid7, "Q201") ~ "Q201",
      str_length(cid7) > 4 & str_detect(cid7, "Q202") ~ "Q202",
      str_length(cid7) > 4 & str_detect(cid7, "Q203") ~ "Q203",
      str_length(cid7) > 4 & str_detect(cid7, "Q204") ~ "Q204",
      str_length(cid7) > 4 & str_detect(cid7, "Q205") ~ "Q205",
      str_length(cid7) > 4 & str_detect(cid7, "Q206") ~ "Q206",
      str_length(cid7) > 4 & str_detect(cid7, "Q210") ~ "Q210",
      str_length(cid7) > 4 & str_detect(cid7, "Q211") ~ "Q211",
      str_length(cid7) > 4 & str_detect(cid7, "Q212") ~ "Q212",
      str_length(cid7) > 4 & str_detect(cid7, "Q213") ~ "Q213",
      str_length(cid7) > 4 & str_detect(cid7, "Q214") ~ "Q214",
      str_length(cid7) > 4 & str_detect(cid7, "Q220") ~ "Q220",
      str_length(cid7) > 4 & str_detect(cid7, "Q224") ~ "Q224",
      str_length(cid7) > 4 & str_detect(cid7, "Q230") ~ "Q230",
      str_length(cid7) > 4 & str_detect(cid7, "Q240") ~ "Q240",
      str_length(cid7) > 4 & str_detect(cid7, "Q242") ~ "Q242",
      str_length(cid7) > 4 & str_detect(cid7, "Q243") ~ "Q243",
      str_length(cid7) > 4 & str_detect(cid7, "Q244") ~ "Q244",
      str_length(cid7) > 4 & str_detect(cid7, "Q245") ~ "Q245",
      str_length(cid7) > 4 & str_detect(cid7, "Q251") ~ "Q251",
      str_length(cid7) > 4 & str_detect(cid7, "Q255") ~ "Q255",
      str_length(cid7) > 4 & str_detect(cid7, "Q260") ~ "Q260",
      str_length(cid7) > 4 & str_detect(cid7, "Q262") ~ "Q262",
      str_length(cid7) > 4 & str_detect(cid7, "Q265") ~ "Q265",
      str_length(cid7) > 4 & str_detect(cid7, "Q266") ~ "Q266",
      str_length(cid7) > 4 & str_detect(cid7, "Q300") ~ "Q300",
      str_length(cid7) > 4 & str_detect(cid7, "Q301") ~ "Q301",
      str_length(cid7) > 4 & str_detect(cid7, "Q302") ~ "Q302",
      str_length(cid7) > 4 & str_detect(cid7, "Q313") ~ "Q313",
      str_length(cid7) > 4 & str_detect(cid7, "Q322") ~ "Q322",
      str_length(cid7) > 4 & str_detect(cid7, "Q323") ~ "Q323",
      str_length(cid7) > 4 & str_detect(cid7, "Q330") ~ "Q330",
      str_length(cid7) > 4 & str_detect(cid7, "Q332") ~ "Q332",
      str_length(cid7) > 4 & str_detect(cid7, "Q333") ~ "Q333",
      str_length(cid7) > 4 & str_detect(cid7, "Q334") ~ "Q334",
      str_length(cid7) > 4 & str_detect(cid7, "Q335") ~ "Q335",
      str_length(cid7) > 4 & str_detect(cid7, "Q336") ~ "Q336",
      str_length(cid7) > 4 & str_detect(cid7, "Q340") ~ "Q340",
      str_length(cid7) > 4 & str_detect(cid7, "Q790") ~ "Q790",
      str_length(cid7) > 4 & str_detect(cid7, "Q35X") ~ "Q35X",
      str_length(cid7) > 4 & str_detect(cid7, "Q042") ~ "Q042",
      str_length(cid7) > 4 & str_detect(cid7, "Q37X") ~ "Q37X",
      str_length(cid7) > 4 & str_detect(cid7, "Q042") ~ "Q042",
      str_length(cid7) > 4 & str_detect(cid7, "Q383") ~ "Q383",
      str_length(cid7) > 4 & str_detect(cid7, "Q384") ~ "Q383",
      str_length(cid7) > 4 & str_detect(cid7, "Q387") ~ "Q387",
      str_length(cid7) > 4 & str_detect(cid7, "Q390") ~ "Q390",
      str_length(cid7) > 4 & str_detect(cid7, "Q391") ~ "Q391",
      str_length(cid7) > 4 & str_detect(cid7, "Q392") ~ "Q392",
      str_length(cid7) > 4 & str_detect(cid7, "Q393") ~ "Q393",
      str_length(cid7) > 4 & str_detect(cid7, "Q396") ~ "Q396",
      str_length(cid7) > 4 & str_detect(cid7, "Q403") ~ "Q403",
      str_length(cid7) > 4 & str_detect(cid7, "Q410") ~ "Q410",
      str_length(cid7) > 4 & str_detect(cid7, "Q423") ~ "Q423",
      str_length(cid7) > 4 & str_detect(cid7, "Q428") ~ "Q428",
      str_length(cid7) > 4 & str_detect(cid7, "Q431") ~ "Q431",
      str_length(cid7) > 4 & str_detect(cid7, "Q433") ~ "Q433",
      str_length(cid7) > 4 & str_detect(cid7, "Q434") ~ "Q434",
      str_length(cid7) > 4 & str_detect(cid7, "Q435") ~ "Q435",
      str_length(cid7) > 4 & str_detect(cid7, "Q436") ~ "Q436",
      str_length(cid7) > 4 & str_detect(cid7, "Q440") ~ "Q440",
      str_length(cid7) > 4 & str_detect(cid7, "Q442") ~ "Q442",
      str_length(cid7) > 4 & str_detect(cid7, "Q446") ~ "Q446",
      str_length(cid7) > 4 & str_detect(cid7, "Q451") ~ "Q451",
      str_length(cid7) > 4 & str_detect(cid7, "Q422") ~ "Q422",
      str_length(cid7) > 4 & str_detect(cid7, "Q500") ~ "Q500",
      str_length(cid7) > 4 & str_detect(cid7, "Q501") ~ "Q501",
      str_length(cid7) > 4 & str_detect(cid7, "Q502") ~ "Q502",
      str_length(cid7) > 4 & str_detect(cid7, "Q505") ~ "Q505",
      str_length(cid7) > 4 & str_detect(cid7, "Q510") ~ "Q510",
      str_length(cid7) > 4 & str_detect(cid7, "Q513") ~ "Q513",
      str_length(cid7) > 4 & str_detect(cid7, "Q516") ~ "Q516",
      str_length(cid7) > 4 & str_detect(cid7, "Q517") ~ "Q517",
      str_length(cid7) > 4 & str_detect(cid7, "Q520") ~ "Q520",
      str_length(cid7) > 4 & str_detect(cid7, "Q521") ~ "Q521",
      str_length(cid7) > 4 & str_detect(cid7, "Q522") ~ "Q522",
      str_length(cid7) > 4 & str_detect(cid7, "Q526") ~ "Q526",
      str_length(cid7) > 4 & str_detect(cid7, "Q527") ~ "Q527",
      str_length(cid7) > 4 & str_detect(cid7, "Q549") ~ "Q549",
      str_length(cid7) > 4 & str_detect(cid7, "Q550") ~ "Q550",
      str_length(cid7) > 4 & str_detect(cid7, "Q553") ~ "Q553",
      str_length(cid7) > 4 & str_detect(cid7, "Q555") ~ "Q555",
      str_length(cid7) > 4 & str_detect(cid7, "Q560") ~ "Q560",
      str_length(cid7) > 4 & str_detect(cid7, "Q600") ~ "Q600",
      str_length(cid7) > 4 & str_detect(cid7, "Q601") ~ "Q601",
      str_length(cid7) > 4 & str_detect(cid7, "Q603") ~ "Q603",
      str_length(cid7) > 4 & str_detect(cid7, "Q604") ~ "Q604",
      str_length(cid7) > 4 & str_detect(cid7, "Q613") ~ "Q613",
      str_length(cid7) > 4 & str_detect(cid7, "Q614") ~ "Q614",
      str_length(cid7) > 4 & str_detect(cid7, "Q620") ~ "Q620",
      str_length(cid7) > 4 & str_detect(cid7, "Q624") ~ "Q624",
      str_length(cid7) > 4 & str_detect(cid7, "Q625") ~ "Q625",
      str_length(cid7) > 4 & str_detect(cid7, "Q630") ~ "Q630",
      str_length(cid7) > 4 & str_detect(cid7, "Q631") ~ "Q631",
      str_length(cid7) > 4 & str_detect(cid7, "Q632") ~ "Q632",
      str_length(cid7) > 4 & str_detect(cid7, "Q640") ~ "Q640",
      str_length(cid7) > 4 & str_detect(cid7, "Q641") ~ "Q642",
      str_length(cid7) > 4 & str_detect(cid7, "Q644") ~ "Q645",
      str_length(cid7) > 4 & str_detect(cid7, "Q646") ~ "Q646",
      str_length(cid7) > 4 & str_detect(cid7, "Q652") ~ "Q652",
      str_length(cid7) > 4 & str_detect(cid7, "Q66X") ~ "Q66X",
      str_length(cid7) > 4 & str_detect(cid7, "Q69X") ~ "Q69X",
      str_length(cid7) > 4 & str_detect(cid7, "Q709") ~ "Q709",
      str_length(cid7) > 4 & str_detect(cid7, "Q716") ~ "Q716",
      str_length(cid7) > 4 & str_detect(cid7, "Q718") ~ "Q718",
      str_length(cid7) > 4 & str_detect(cid7, "Q728") ~ "Q728",
      str_length(cid7) > 4 & str_detect(cid7, "Q743") ~ "Q743",
      str_length(cid7) > 4 & str_detect(cid7, "Q750") ~ "Q750",
      str_length(cid7) > 4 & str_detect(cid7, "Q751") ~ "Q751",
      str_length(cid7) > 4 & str_detect(cid7, "Q770") ~ "Q770",
      str_length(cid7) > 4 & str_detect(cid7, "Q771") ~ "Q771",
      str_length(cid7) > 4 & str_detect(cid7, "Q772") ~ "Q772",
      str_length(cid7) > 4 & str_detect(cid7, "Q773") ~ "Q773",
      str_length(cid7) > 4 & str_detect(cid7, "Q775") ~ "Q775",
      str_length(cid7) > 4 & str_detect(cid7, "Q776") ~ "Q776",
      str_length(cid7) > 4 & str_detect(cid7, "Q777") ~ "Q777",
      str_length(cid7) > 4 & str_detect(cid7, "Q780") ~ "Q780",
      str_length(cid7) > 4 & str_detect(cid7, "Q781") ~ "Q781",
      str_length(cid7) > 4 & str_detect(cid7, "Q782") ~ "Q782",
      str_length(cid7) > 4 & str_detect(cid7, "Q783") ~ "Q783",
      str_length(cid7) > 4 & str_detect(cid7, "Q784") ~ "Q784",
      str_length(cid7) > 4 & str_detect(cid7, "Q785") ~ "Q785",
      str_length(cid7) > 4 & str_detect(cid7, "Q786") ~ "Q786",
      str_length(cid7) > 4 & str_detect(cid7, "Q792") ~ "Q792",
      str_length(cid7) > 4 & str_detect(cid7, "Q793") ~ "Q793",
      str_length(cid7) > 4 & str_detect(cid7, "Q794") ~ "Q794",
      str_length(cid7) > 4 & str_detect(cid7, "Q809") ~ "Q809",
      str_length(cid7) > 4 & str_detect(cid7, "Q819") ~ "Q819",
      str_length(cid7) > 4 & str_detect(cid7, "Q820") ~ "Q820",
      str_length(cid7) > 4 & str_detect(cid7, "Q821") ~ "Q821",
      str_length(cid7) > 4 & str_detect(cid7, "Q822") ~ "Q822",
      str_length(cid7) > 4 & str_detect(cid7, "Q823") ~ "Q823",
      str_length(cid7) > 4 & str_detect(cid7, "Q824") ~ "Q824",
      str_length(cid7) > 4 & str_detect(cid7, "Q860") ~ "Q860",
      str_length(cid7) > 4 & str_detect(cid7, "Q861") ~ "Q861",
      str_length(cid7) > 4 & str_detect(cid7, "Q862") ~ "Q862",
      TRUE ~ cid7
    )
  )
```

```{r echo=FALSE}
# tabela com as cids agrupadas recodificadas pela mariana s.

d_recod <- readxl::read_excel("tab_auxiliares/coda_recod.xlsx") |>
  rename(cid10_coa = `...4`) |>
  select(cid10, cid10_coa)

# tabela com os nomes das cids

d_nomes <- readxl::read_xlsx("tab_auxiliares/cid10_eurocat.xlsx", sheet = 1) |>
  select(categoria_cid10, categoria)

# transformando dados em formato longo

d_coda <- d_anom |>
  select(cf2:cf7)

d_long <- d_coda |>
  pivot_longer(
    cols = cf2:cf7,
    names_to = "coda_eurocat", values_to = "cid10"
 )

# tabela de frequencias das cid-10, segundo a eurocat

tab_cid10 <- d_long |>
  filter(cid10 == "Q250" | !cid10 %in% cid_menor$categoria_cid10) |>
  filter(!is.na(cid10)) |>
  left_join(d_recod, by = "cid10") |>
  mutate(cid10_novo = coalesce(cid10_coa, cid10)) |>
  group_by(cid10_novo) |>
  summarise(n = n()) |>
  mutate(`%` = sprintf("%.2f", (n / sum(n)) * 100)) |>
  arrange(desc(n)) |>
  left_join(d_nomes, by = join_by("cid10_novo" == "categoria_cid10")) |>
  rename(cid10 = cid10_novo) |>
  mutate(categoria = ifelse(cid10 == "Q250", "Permeabilidade do canal arterial", categoria)) |> 
  relocate(cid10, categoria)

# tabelas de frequencias das cid-10, segundo grupos e subgrupos da eurocat

freqs_cid10 <- readxl::read_xlsx("tab_auxiliares/freqs_cid10_eurocat.xlsx", skip = 1)

# grupo
freqs_grupo <- freqs_cid10 |> 
  group_by(grupo) |> 
  summarise(n = sum(n)) |>
  mutate(`%` = sprintf("%.2f", (n / sum(n)) * 100)) |> 
  arrange(desc(n))

# subgrupo
freqs_sgrupo <- freqs_cid10 |> 
  group_by(subgrupo) |> 
  summarise(n = sum(n)) |>
  mutate(`%` = sprintf("%.2f", (n / sum(n)) * 100)) |> 
  arrange(desc(n)) |> 
  filter(!is.na(subgrupo))

# subsubgrupo
freqs_ssgrupo <- freqs_cid10 |> 
  group_by(subsubgrupo) |> 
  summarise(n = sum(n)) |>
  mutate(`%` = sprintf("%.2f", (n / sum(n)) * 100)) |> 
  arrange(desc(n)) |> 
  filter(!is.na(subsubgrupo))

# subsubsubgrupo
freqs_sssgrupo <- freqs_cid10 |> 
  group_by(subsubsubgrupo) |> 
  summarise(n = sum(n)) |>
  mutate(`%` = sprintf("%.2f", (n / sum(n)) * 100)) |> 
  arrange(desc(n)) |> 
  filter(!is.na(subsubsubgrupo))
```

### Gráfico de frequências dos grupos de malformações congênitas

```{r}
readxl::read_xlsx("tab_auxiliares/freqs_cid10_eurocat.xlsx", skip = 1) |> 
  mutate(
    grupo = case_when(
      grupo == "Membros" ~ "Limbs",
      grupo == "Sistema nervoso" ~ "Nervous system",
      grupo == "Cardiopatias" ~ "Congenital heart defect",
      grupo == "Fendas oro-faciais" ~ "Cleft lip and cleft palate",
      grupo == "Genitália" ~ "Genital organs", 
      grupo == "Outros" ~ "Other congenital anomalies",
      grupo == "Sistema digestivo" ~ "Digestive system",
      grupo == "Defeitos de parede abdominal" ~ "Abdominal wall defects",
      grupo == "Sistema urinário" ~ "Urinary system",
      grupo == "Respiratórias" ~ "Respiratory system",
      grupo == "Orelha, face e pescoço" ~ "Ear, face and neck",
      grupo == "Olhos" ~ "Eyes",
      TRUE ~ NA_character_
    )
  ) |> 
  group_by(grupo) |> 
  summarise(n = sum(n)) |>
  mutate(
    `%` = round((n / sum(n)), 4) * 100,
    grupo = forcats::fct_reorder(grupo, -`%`)
  ) |> 
  ggplot() +
    geom_col(aes(x = grupo, y = `%`, fill = grupo)) + 
    labs(y = "Frequency (%)", fill = "Anomalies:") + 
    geom_label(
      aes(grupo, `%`, label = sprintf("%.2f", `%`), fill = grupo), 
      position = position_dodge(width = .9), vjust = 1.2, size = 7, color = "#000000", 
      show.legend = FALSE
    ) +
    scale_y_continuous(breaks = seq(0, 40, by = 5)) +
    scale_fill_manual(values = wes_palette("Zissou1", 12, type = "continuous")) +
    theme_bw() +
    theme(
      text = element_text(size = 20),
      axis.title.x = element_blank(),
      axis.text.x = element_blank(),
      axis.ticks.x = element_blank(),
      legend.position = "bottom"
    )
```

### Gráfico de frequências das 10 malformações congênitas mais frequentes

```{r}
tab_cid10 |> 
  slice(1:10) |> 
  mutate(
    categoria = case_when(
      cid10 == "Q699" ~ "Polydactyly, unspecified",
      cid10 == "Q690" ~ "Accessory finger(s)",
      cid10 == "Q549" ~ "Hypospadias, unspecified",
      cid10 == "Q359" ~ "Cleft palate, unspecified",
      cid10 == "Q793" ~ "Gastroschisis",
      cid10 == "Q02X" ~ "Microcephaly",
      cid10 == "Q039" ~ "Congenital hydrocephalus, unspecified",
      cid10 == "Q059" ~ "Spina bifida, unspecified",
      cid10 == "Q249" ~ "Congenital malformation of heart, unspecified",
      cid10 == "Q211" ~ "Atrial septal defect",
      TRUE ~ NA_character_
    )
  ) |> 
  mutate(
    cid10 = forcats::fct_reorder(cid10, -as.numeric(`%`)),
    categoria = forcats::fct_reorder(categoria, -as.numeric(`%`))
  ) |>
  # grafico de barras
  ggplot() +
    geom_col(aes(x = cid10, y = as.numeric(`%`), fill = categoria)) + 
    labs(x = "CID-10", y = "Frequency (%)", fill = "Description:") + 
    geom_label(
      aes(cid10, as.numeric(`%`), label = sprintf("%.2f", as.numeric(`%`)), fill = categoria), 
      position = position_dodge(width = .9), vjust = 1.2, size = 7, color = "#000000", 
      show.legend = FALSE
    ) +
    scale_y_continuous(breaks = seq(0, 10, by = 2)) +
    scale_fill_manual(values = wes_palette("Zissou1", 10, type = "continuous")) +
    theme_bw() +
    theme(
      text = element_text(size = 20),
      legend.position = c(.82, .8),
      legend.background = element_rect(linetype = "solid", colour = "#000000")
    )
```

\newpage

# 9. Tabela e gráficos de prevalências dos grupos de anomalias congênitas

Nesta seção, encontram-se a tabela de prevalência de malformações congênitas prioritárias, segundo grupos definidos pela EUROCAT e características maternas, da gestação, do parto e do recém-nascido, e os mapas geográficos representativos da distribuição das prevalências desses grupos, por estado de residência da mãe.

Para calcular as prevalência dos grupos de malformações congênitas, foi feita a razão entre o número de ocorrência de cada grupo e o total de nascidos vivos (NV) registrados no período analisado multiplicado por um fator de 1.000 NV. Para calcular as prevalências dos grupos de malformações congênitas a nível estadual, o raciocínio foi análogo, porém considerando o total de NV no período analisado e estado.

### Tabela de prevalência dos grupos de malformações congênitas

Código omitido. Verificar no arquivo `anom.Rmd`.

Resultado omitido. Foi gerado o arquivo `tab_prevs.xlsx`.

```{r echo=FALSE}
# carregando microdados do sinasc (2011 a 2020)

d_sinasc <- readr::read_csv("01.dados/sinasc/sinasc_11-20[microdatasus].csv.gz") 

# categorizando variaveis

d_sinasc <- d_sinasc |> 
  mutate(
    PARTO_m = case_when(
      PARTO == 1 ~ "Vaginal", PARTO == 2 ~ "Cesáreo",
      TRUE ~ NA_character_
    ),
    RACACORMAE_m = case_when(
      RACACORMAE == 1 ~ "Branca", RACACORMAE == 2 ~ "Preta",
      RACACORMAE == 3 ~ "Amarela", RACACORMAE == 4 ~ "Parda",
      RACACORMAE == 5 ~ "Indígena",
      TRUE ~ NA_character_
    ),
    SEXO_m = case_when(
      SEXO == 1 ~ "Masculino", SEXO == 2 ~ "Feminino",
      TRUE ~ NA_character_
    ),
    ESTCIVMAE_m = case_when(
      ESTCIVMAE == 1 ~ "Solteiro", ESTCIVMAE == 2 ~ "Casado",
      ESTCIVMAE == 3 ~ "Viúvo", ESTCIVMAE == 4 ~ "Separado Judic./Divorciado",
      ESTCIVMAE == 5 ~ "União consensual",
      TRUE ~ NA_character_
    ),
    ESCMAE_m = case_when(
      ESCMAE == 1 ~ "Nenhuma", ESCMAE == 2 ~ "1 a 3 anos",
      ESCMAE == 3 ~ "4 a 7 anos", (ESCMAE == 4 | ESCMAE == 8) ~ "8 a 11 anos",
      ESCMAE == 5 ~ "12 e mais",
      TRUE ~ NA_character_
    ),
    GRAVIDEZ_m = case_when(
      GRAVIDEZ == 1 ~ "Única", GRAVIDEZ == 2 ~ "Dupla",
      GRAVIDEZ == 3 ~ "Tripla ou mais",
      TRUE ~ NA_character_
    ),
    GESTACAO_m = case_when(
      GESTACAO == 1 ~ "Menos de 22 semanas", GESTACAO == 2 ~ "22 a 27 semanas",
      GESTACAO == 3 ~ "28 a 31 semanas", GESTACAO == 4 ~ "32 a 36 semanas",
      GESTACAO == 5 ~ "37 a 41 semanas", GESTACAO == 6 ~ "42 semanas e mais",
      TRUE ~ NA_character_
    ),
    CONSULTAS_m = case_when(
      CONSULTAS == 1 ~ "Nenhuma", CONSULTAS == 2 ~ "de 1 a 3",
      CONSULTAS == 3 ~ "de 4 a 6", CONSULTAS == 4 ~ "7 e mais",
      TRUE ~ NA_character_
    )
  ) |> 
  # selecionando somente variaveis de interesse
  select(ends_with("_m"))

### calculando o numero total de nv, por variavel ###

# parto
n_par <- d_sinasc |> 
  group_by(PARTO_m) |> 
  summarise(n_nasc = n()) |> 
  mutate(va = "parto") |> 
  rename(categoria = PARTO_m) |> 
  filter(!is.na(categoria)) |> 
  relocate(va)

# raca/cor da mae
n_rac <- d_sinasc |> 
  group_by(RACACORMAE_m) |> 
  summarise(n_nasc = n()) |> 
  mutate(va = "racacormae") |> 
  rename(categoria = RACACORMAE_m) |> 
  filter(!is.na(categoria)) |> 
  relocate(va)

# sexo
n_sex <- d_sinasc |> 
  group_by(SEXO_m) |> 
  summarise(n_nasc = n()) |> 
  mutate(va = "sexo") |> 
  rename(categoria = SEXO_m) |> 
  filter(!is.na(categoria)) |> 
  relocate(va)

# estado civil da mae
n_civ <- d_sinasc |> 
  group_by(ESTCIVMAE_m) |> 
  summarise(n_nasc = n()) |> 
  mutate(va = "estcivmae") |> 
  rename(categoria = ESTCIVMAE_m) |> 
  filter(!is.na(categoria)) |> 
  relocate(va)

# escolaridade da mae
n_esc <- d_sinasc |> 
  group_by(ESCMAE_m) |> 
  summarise(n_nasc = n()) |>   
  mutate(va = "escmae") |> 
  rename(categoria = ESCMAE_m) |> 
  filter(!is.na(categoria)) |> 
  relocate(va)

# tipo de gravidez
n_gra <- d_sinasc |> 
  group_by(GRAVIDEZ_m) |> 
  summarise(n_nasc = n()) |> 
  mutate(va = "gravidez") |>
  rename(categoria = GRAVIDEZ_m) |> 
  filter(!is.na(categoria)) |> 
  relocate(va)

# idade gestacional
n_ges <- d_sinasc |> 
  group_by(GESTACAO_m) |> 
  summarise(n_nasc = n()) |> 
  mutate(va = "gestacao") |> 
  rename(categoria = GESTACAO_m) |> 
  filter(!is.na(categoria)) |> 
  relocate(va)

# numero de consultas de pre-natal
n_con <- d_sinasc |> 
  group_by(CONSULTAS_m) |> 
  summarise(n_nasc = n()) |> 
  mutate(va = "consultas") |> 
  rename(categoria = CONSULTAS_m) |> 
  filter(!is.na(categoria)) |> 
  relocate(va)

# unindo todas as bases

d_all_nv <- n_par |> 
  bind_rows(n_rac, n_sex, n_civ, n_esc, n_gra, n_ges, n_con)
```

```{r echo=FALSE}
# incluindo informacoes de grupos a base de anomalias congenitas

d_anom_gr <- d_anom |> 
  select(
    res_NOME_UF,
    cf2:cf7, 
    racacor_mae, def_escol_mae, def_est_civil, 
    def_consultas, def_gestacao, def_gravidez, def_parto, 
    def_sexo
  ) |> 
  # cf2
  left_join(freqs_cid10 |> select(cid10, grupo), by = join_by(cf2 == cid10)) |> 
  rename(g2 = grupo) |> 
  relocate(cf2, g2) |> 
  # cf3
  left_join(freqs_cid10 |> select(cid10, grupo), by = join_by(cf3 == cid10)) |> 
  rename(g3 = grupo) |> 
  relocate(cf2, g2, cf3, g3) |> 
  # cf4
  left_join(freqs_cid10 |> select(cid10, grupo), by = join_by(cf4 == cid10)) |> 
  rename(g4 = grupo) |> 
  relocate(cf2, g2, cf3, g3, cf4, g4) |> 
  # cf5
  left_join(freqs_cid10 |> select(cid10, grupo), by = join_by(cf5 == cid10)) |> 
  rename(g5 = grupo) |> 
  relocate(cf2, g2, cf3, g3, cf4, g4, cf5, g5) |> 
  # cf6
  left_join(freqs_cid10 |> select(cid10, grupo), by = join_by(cf6 == cid10)) |> 
  rename(g6 = grupo) |> 
  relocate(cf2, g2, cf3, g3, cf4, g4, cf5, g5, cf6, g6) |> 
  # cf7
  left_join(freqs_cid10 |> select(cid10, grupo), by = join_by(cf7 == cid10)) |> 
  rename(g7 = grupo) |> 
  relocate(cf2, g2, cf3, g3, cf4, g4, cf5, g5, cf6, g6, cf7, g7) |> 
  # removendo variaveis de cid-10
  select(-c(starts_with("cf")))

# transformando variaveis de grupos em formato longo

d_anom_gr_long <- d_anom_gr |> 
  pivot_longer(
    cols = g2:g7,
    names_to = "g", values_to = "grupo_eur"
  ) |> 
  filter(!is.na(grupo_eur))

### calculando o numero de anomalias, por grupo e variavel ###

# tipo de parto
a_par <- d_anom_gr_long |> 
  group_by(grupo_eur, def_parto) |> 
  summarise(n_anom = n()) |> 
  mutate(va = "parto") |> 
  rename(categoria = def_parto) |> 
  filter(!is.na(categoria)) |> 
  relocate(grupo_eur, va)

# raca/cor da mae
a_rac <- d_anom_gr_long |> 
  group_by(grupo_eur, racacor_mae) |> 
  summarise(n_anom = n()) |> 
  mutate(va = "racacormae") |> 
  rename(categoria = racacor_mae) |> 
  filter(!is.na(categoria)) |> 
  relocate(grupo_eur, va)

# sexo
a_sex <- d_anom_gr_long |> 
  group_by(grupo_eur, def_sexo) |> 
  summarise(n_anom = n()) |> 
  mutate(va = "sexo") |> 
  rename(categoria = def_sexo) |> 
  filter(!is.na(categoria)) |> 
  relocate(grupo_eur, va)

# estado civil da mae
a_civ <- d_anom_gr_long |> 
  group_by(grupo_eur, def_est_civil) |> 
  summarise(n_anom = n()) |> 
  mutate(va = "estcivmae") |> 
  rename(categoria = def_est_civil) |> 
  filter(!is.na(categoria)) |> 
  relocate(grupo_eur, va)

# escolaridade da mae
a_esc <- d_anom_gr_long |> 
  group_by(grupo_eur, def_escol_mae) |> 
  summarise(n_anom = n()) |> 
  mutate(va = "escmae") |> 
  rename(categoria = def_escol_mae) |> 
  filter(!is.na(categoria)) |> 
  relocate(grupo_eur, va)

# tipo de gravidez
a_gra <- d_anom_gr_long |> 
  group_by(grupo_eur, def_gravidez) |> 
  summarise(n_anom = n()) |> 
  mutate(va = "gravidez") |> 
  rename(categoria = def_gravidez) |> 
  filter(!is.na(categoria)) |> 
  relocate(grupo_eur, va)

# idade gestacional
a_ges <- d_anom_gr_long |> 
  group_by(grupo_eur, def_gestacao) |> 
  summarise(n_anom = n()) |> 
  mutate(va = "gestacao") |> 
  rename(categoria = def_gestacao) |> 
  filter(!is.na(categoria)) |> 
  relocate(grupo_eur, va)

# numero de consultas de pre-natal
a_con <- d_anom_gr_long |> 
  group_by(grupo_eur, def_consultas) |> 
  summarise(n_anom = n()) |> 
  mutate(va = "consultas") |> 
  rename(categoria = def_consultas) |> 
  filter(!is.na(categoria)) |> 
  relocate(grupo_eur, va)

# unindo todas as bases

d_all_anom <- a_par |> 
  bind_rows(a_rac, a_sex, a_civ, a_esc, a_gra, a_ges, a_con)
```

```{r echo=FALSE}
# calculando as prevalencias

# por anomalias (grupos) gerais e caracteristicas

d_all_anom_geral <- readxl::read_xlsx("tab_auxiliares/n_nv_por_categoria.xlsx")

prev_all <- left_join(d_all_anom_geral, d_all_nv, by = c("va", "categoria")) |> 
  mutate(prev = sprintf("%.2f", (n_geral / n_nasc) * 1000))

# por grupo e caracteristicas

prev_anc <- left_join(d_all_anom, d_all_nv, by = c("va", "categoria")) |> 
  mutate(prev = sprintf("%.2f", (n_anom / n_nasc) * 1000))
```

### Mapas da distribuição de prevalência dos grupos de malformações congênitas

Código omitido. Verificar no arquivo `analise_descritiva[2024-02-09].Rmd`.

Resultado omitido. Foi gerado o arquivo `g_map.png`.

```{r echo=FALSE}
# calculando o numero de anomalias, por uf e grupo

d_anom_gr_uf <- d_anom_gr_long |> 
  group_by(res_NOME_UF, grupo_eur) |> 
  summarise(n_anom = n()) |> 
  rename(name_state = res_NOME_UF)

# calculando o numero de nv, por uf

d_nv_uf <- dados_nasc_ano_uf |> 
  group_by(local) |> 
  summarise(n_nasc = sum(total))
```

```{r echo=FALSE}
# obtendo informacoes geograficas dos estados brasileiros

sf_uf_br <- read_state(code_state = "all", year = 2020, showProgress = FALSE) |> 
  # corrigindo grafia de alguns estados
  mutate(
    name_state = ifelse(name_state == "Amazônas", "Amazonas",
                  ifelse(name_state == "Mato Grosso Do Sul", "Mato Grosso do Sul",
                   ifelse(name_state == "Rio De Janeiro", "Rio de Janeiro",
                    ifelse(name_state == "Rio Grande Do Norte", "Rio Grande do Norte",
                     ifelse(name_state == "Rio Grande Do Sul", "Rio Grande do Sul", name_state)))))
  )
```

```{r echo=FALSE}
# calculando prevalencia de anomalias, por grupo e uf

d_geobr <- sf_uf_br |> 
  left_join(d_nv_uf, by = join_by(name_state == local)) |> 
  left_join(d_anom_gr_uf, by = "name_state") |> 
  mutate(prev = (n_anom / n_nasc) * 1000)
```

```{r echo=FALSE}
# construindo mapas das prevalencias, por grupo

# cardiopatias
g01 <- ggplot(d_geobr |> filter(grupo_eur == "Cardiopatias"), aes(fill = prev)) + 
  geom_sf() +
  scale_fill_gradientn(colours = wes_palette("Zissou1", 100, type = "continuous"), label = function(x) gsub("\\.", ",", sprintf("%.1f", x))) +
  labs(title = "Cardiopatias", fill = "Prevalência \npor 1.000 NV") +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    panel.background = element_blank(), plot.background = element_blank(),
    panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    axis.title = element_blank(), axis.text = element_blank(),
    axis.ticks = element_blank()
  ) +
  annotation_scale(location = "br") +
  annotation_north_arrow(
    location = "br", which_north = "true", 
    pad_x = unit(0.5, "in"), pad_y = unit(0.2, "in"),
    style = north_arrow_fancy_orienteering
  )

# defeitos de parede abdominal
g02 <- ggplot(d_geobr |> filter(grupo_eur == "Defeitos de parede abdominal"), aes(fill = prev)) + 
  geom_sf() +
  scale_fill_gradientn(colours = wes_palette("Zissou1", 100, type = "continuous"), label = function(x) gsub("\\.", ",", sprintf("%.1f", x))) +
  labs(title = "Defeitos de parede abdominal", fill = "Prevalência \npor 1.000 NV") +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    panel.background = element_blank(), plot.background = element_blank(),
    panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    axis.title = element_blank(), axis.text = element_blank(),
    axis.ticks = element_blank()
  ) +
  annotation_scale(location = "br") +
  annotation_north_arrow(
    location = "br", which_north = "true", 
    pad_x = unit(0.5, "in"), pad_y = unit(0.2, "in"),
    style = north_arrow_fancy_orienteering
  )

# fendas oro-faciais
g03 <- ggplot(d_geobr |> filter(grupo_eur == "Fendas oro-faciais"), aes(fill = prev)) + 
  geom_sf() +
  scale_fill_gradientn(colours = wes_palette("Zissou1", 100, type = "continuous"), label = function(x) gsub("\\.", ",", sprintf("%.1f", x))) +
  labs(title = "Fendas oro-faciais", fill = "Prevalência \npor 1.000 NV") +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    panel.background = element_blank(), plot.background = element_blank(),
    panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    axis.title = element_blank(), axis.text = element_blank(),
    axis.ticks = element_blank()
  ) +
  annotation_scale(location = "br") +
  annotation_north_arrow(
    location = "br", which_north = "true", 
    pad_x = unit(0.5, "in"), pad_y = unit(0.2, "in"),
    style = north_arrow_fancy_orienteering
  )

# genitalia
g04 <- ggplot(d_geobr |> filter(grupo_eur == "Genitália"), aes(fill = prev)) + 
  geom_sf() +
  scale_fill_gradientn(colours = wes_palette("Zissou1", 100, type = "continuous"), label = function(x) gsub("\\.", ",", sprintf("%.1f", x))) +
  labs(title = "Genitália", fill = "Prevalência \npor 1.000 NV") +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    panel.background = element_blank(), plot.background = element_blank(),
    panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    axis.title = element_blank(), axis.text = element_blank(),
    axis.ticks = element_blank()
  ) +
  annotation_scale(location = "br") +
  annotation_north_arrow(
    location = "br", which_north = "true", 
    pad_x = unit(0.5, "in"), pad_y = unit(0.2, "in"),
    style = north_arrow_fancy_orienteering
  )

# membros
g06 <- ggplot(d_geobr |> filter(grupo_eur == "Membros"), aes(fill = prev)) + 
  geom_sf() +
  scale_fill_gradientn(colours = wes_palette("Zissou1", 100, type = "continuous"), label = function(x) gsub("\\.", ",", sprintf("%.1f", x))) +
  labs(title = "Membros", fill = "Prevalência \npor 1.000 NV") +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    panel.background = element_blank(), plot.background = element_blank(),
    panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    axis.title = element_blank(), axis.text = element_blank(),
    axis.ticks = element_blank()
  ) +
  annotation_scale(location = "br") +
  annotation_north_arrow(
    location = "br", which_north = "true", 
    pad_x = unit(0.5, "in"), pad_y = unit(0.2, "in"),
    style = north_arrow_fancy_orienteering
  )

# olhos
g07 <- ggplot(d_geobr |> filter(grupo_eur == "Olhos"), aes(fill = prev)) + 
  geom_sf() +
  scale_fill_gradientn(colours = wes_palette("Zissou1", 100, type = "continuous"), label = function(x) gsub("\\.", ",", sprintf("%.1f", x))) +
  labs(title = "Olhos", fill = "Prevalência \npor 1.000 NV") +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    panel.background = element_blank(), plot.background = element_blank(),
    panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    axis.title = element_blank(), axis.text = element_blank(),
    axis.ticks = element_blank()
  ) +
  annotation_scale(location = "br") +
  annotation_north_arrow(
    location = "br", which_north = "true", 
    pad_x = unit(0.5, "in"), pad_y = unit(0.2, "in"),
    style = north_arrow_fancy_orienteering
  )

# orelha, face e pescoco
g08 <- ggplot(d_geobr |> filter(grupo_eur == "Orelha, face e pescoço"), aes(fill = prev)) + 
  geom_sf() +
  scale_fill_gradientn(colours = wes_palette("Zissou1", 100, type = "continuous"), label = function(x) gsub("\\.", ",", sprintf("%.1f", x))) +
  labs(title = "Orelha, face e pescoço", fill = "Prevalência \npor 1.000 NV") +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    panel.background = element_blank(), plot.background = element_blank(),
    panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    axis.title = element_blank(), axis.text = element_blank(),
    axis.ticks = element_blank()
  ) +
  annotation_scale(location = "br") +
  annotation_north_arrow(
    location = "br", which_north = "true", 
    pad_x = unit(0.5, "in"), pad_y = unit(0.2, "in"),
    style = north_arrow_fancy_orienteering
  )

# respiratorias
g09 <- ggplot(d_geobr |> filter(grupo_eur == "Respiratórias"), aes(fill = prev)) + 
  geom_sf() +
  scale_fill_gradientn(colours = wes_palette("Zissou1", 100, type = "continuous"), label = function(x) gsub("\\.", ",", sprintf("%.1f", x))) +
  labs(title = "Respiratórias", fill = "Prevalência \npor 1.000 NV") +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    panel.background = element_blank(), plot.background = element_blank(),
    panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    axis.title = element_blank(), axis.text = element_blank(),
    axis.ticks = element_blank()
  ) +
  annotation_scale(location = "br") +
  annotation_north_arrow(
    location = "br", which_north = "true", 
    pad_x = unit(0.5, "in"), pad_y = unit(0.2, "in"),
    style = north_arrow_fancy_orienteering
  )

# sistema digestivo
g10 <- ggplot(d_geobr |> filter(grupo_eur == "Sistema digestivo"), aes(fill = prev)) + 
  geom_sf() +
  scale_fill_gradientn(colours = wes_palette("Zissou1", 100, type = "continuous"), label = function(x) gsub("\\.", ",", sprintf("%.1f", x))) +
  labs(title = "Sistema digestivo", fill = "Prevalência \npor 1.000 NV") +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    panel.background = element_blank(), plot.background = element_blank(),
    panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    axis.title = element_blank(), axis.text = element_blank(),
    axis.ticks = element_blank()
  ) +
  annotation_scale(location = "br") +
  annotation_north_arrow(
    location = "br", which_north = "true", 
    pad_x = unit(0.5, "in"), pad_y = unit(0.2, "in"),
    style = north_arrow_fancy_orienteering
  )

# sistema nervoso
g11 <- ggplot(d_geobr |> filter(grupo_eur == "Sistema nervoso"), aes(fill = prev)) + 
  geom_sf() +
  scale_fill_gradientn(colours = wes_palette("Zissou1", 100, type = "continuous"), label = function(x) gsub("\\.", ",", sprintf("%.1f", x))) +
  labs(title = "Sistema nervoso", fill = "Prevalência \npor 1.000 NV") +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    panel.background = element_blank(), plot.background = element_blank(),
    panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    axis.title = element_blank(), axis.text = element_blank(),
    axis.ticks = element_blank()
  ) +
  annotation_scale(location = "br") +
  annotation_north_arrow(
    location = "br", which_north = "true", 
    pad_x = unit(0.5, "in"), pad_y = unit(0.2, "in"),
    style = north_arrow_fancy_orienteering
  )

# sistema urinario
g12 <- ggplot(d_geobr |> filter(grupo_eur == "Sistema urinário"), aes(fill = prev)) + 
  geom_sf() +
  scale_fill_gradientn(colours = wes_palette("Zissou1", 100, type = "continuous"), label = function(x) gsub("\\.", ",", sprintf("%.1f", x))) +
  labs(title = "Sistema urinário", fill = "Prevalência \npor 1.000 NV") +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    panel.background = element_blank(), plot.background = element_blank(),
    panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    axis.title = element_blank(), axis.text = element_blank(),
    axis.ticks = element_blank()
  ) +
  annotation_scale(location = "br") +
  annotation_north_arrow(
    location = "br", which_north = "true", 
    pad_x = unit(0.5, "in"), pad_y = unit(0.2, "in"),
    style = north_arrow_fancy_orienteering
  )

#(g01 + g02 + g03) / (g04 + g06 + g07) / (g08 + g09 + g10) / (g11 + g12)
```

\newpage

# 10. Análise AACP

Nesta seção, a variação percentual média anual (Average Annual Percent Change - AACP, em inglês), por grupo de malformação, é realizada.

Código otimido. Verificar no arquivo `anom_supp.Rmd`.

Resultado omitido. Foi gerado o arquivo `tab_aacp.xlsx`.


